      <div class="loader-overlay" *ngIf="loader">
       <mat-spinner></mat-spinner>
      </div>
<div class="card">
  <div class="card-header border-0 pt-6">
    <div class="card-title">
      <div class="d-flex align-items-center position-relative my-1">
        <i class="fas fa-search fs-3 position-absolute ms-5"></i>
        <input type="text" [(ngModel)]="searchText" (input)="applyFilters()"
          class="form-control form-control-solid w-250px ps-12" placeholder="Search Reports" />
      </div>
    </div>
    <!-- Drop List for columns -->
    <div class="toolbar mb-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Select Columns</mat-label>
        <mat-select [(ngModel)]="selectedColumns" (selectionChange)="onColumnSelectionChange()" multiple>
          <mat-option *ngFor="let column of displayedColumns" [value]="column.field">
            {{ column.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="row d-flex mb-3 align-items-center outer pt-4 pb-2 px-3 m-0">
      <div class="col-md-2" style="float: left; padding-right: 10px;">
      <select  class="form-select" (change)="onCityChange($event)" [(ngModel)]="selectedDistrict">
        <option value="" selected hidden disabled>Police City</option>
        <option *ngFor="let district of districts" [value]="district">{{ district }}</option>
      </select>
      </div>

      <div class="col-md-2" style="float: left;  padding-right: 10px;">
      <select  class="form-select" [(ngModel)]="selectedPoliceZone">
        <option value="" selected hidden disabled>Police Zone</option>
        <option *ngFor="let item of policeZones" [value]="item">{{ item }}</option>
      </select>
      </div>


      <!-- <div class="col-md-3">
      <select class="form-select" [(ngModel)]="selectedPoliceRange">
        <option value="" selected hidden disabled>Police Range</option>
        <option *ngFor="let item of policeRanges" [value]="item.police_range">{{ item.police_range }}</option>
      </select>
      </div> -->

      <div class="col-md-2" *ngIf="Parsed_UserInfo.access_type != 'District'"  style="float: left;  padding-right: 10px;">
      <select  class="form-select"
        [(ngModel)]="selectedRevenue_district">
        <option value="" selected hidden disabled>Revenue District</option>
        <option *ngFor="let item of revenueDistricts" [value]="item.revenue_district">{{ item.revenue_district }}
        </option>
      </select>
      </div>

       <!-- <select  class="form-select"
       [(ngModel)]="selectedPoliceStation">
          <option value="" disabled>Police Station</option>
          <option *ngFor="let station of policeStations" [value]="station">{{ station }}</option>
       </select> -->

       <!-- <div class="col-md-3"  style="float: left;  padding-right: 10px;">
        <select  class="form-select"
       [(ngModel)]="selectedProposal">
          <option value="" disabled>Proposal Sent to DC</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
       </select>
       </div> -->

       <div class="col-md-2 "  style="float: left;  padding-right: 10px;">
        <select class="form-select"
       [(ngModel)]="selectedCommunity" (change)="onCommunityChange($event)"  >
          <option value="" disabled>Community</option>
          <option *ngFor="let community of communitiesOptions" [value]="community">{{ community }}</option>
        </select>
       </div>

       <div class="col-md-2" style="float: left; padding-right: 10px;">
        <select  class="form-select"  [(ngModel)]="selectedCaste">
          <option value="" disabled>Caste</option>
          <option *ngFor="let caste of casteOptions" [value]="caste">{{ caste }}</option>
      </select>
       </div>

        <div class="col-md-2" style="float: left; padding-right: 10px;">
        <select  class="form-select"  [(ngModel)]="selectedSectionOfLaw">
          <option value="" disabled>Section of Law</option>
        <option *ngFor="let section of sectionOfLaw" [value]="section.offence_act_name">{{ section.offence_act_name }}</option>
      </select>
       </div>

       <div class="col-md-4 mt-2" style="float: left; padding-right: 10px;">
        <select class="form-select" [(ngModel)]="selectedOffenceGroup">
        <option value=""  disabled>Nature of Case</option>
        <option *ngFor="let item of offenceGroupsList" [value]="item">
          {{ item }}
        </option>
      </select>
       </div>

       <div class="col-md-2 mt-2" style="float: left; padding-right: 10px;">
        <div class="tooltip-container" style="display: block;">
        <input type="date" [(ngModel)]="startDate"  class="form-control"
          placeholder="Start Date">
        <span class="tooltip-text">Date of Registration From Date</span>
      </div>
      </div>

      <div class="col-md-2 mt-2" style="float: left; padding-right: 10px;">
      <div class="tooltip-container" style="display: block;">
        <input type="date" [(ngModel)]="endDate"  class="form-control" placeholder="End Date">
        <span class="tooltip-text">Date of Registration To Date</span>
      </div>
      </div>
      
      <!-- <div class="col-md-2 mt-2" style="float: left; padding-right: 10px;">
        <select class="form-select" [(ngModel)]="selectedStatusOfCase">
        <option value="" selected>Status of Case</option>
        <option value="UI">UI</option>
        <option value="PT">PT</option>
        <option value="Convicted">Conviction</option>
        <option value="Acquitted">Acquitted</option>
        <option value="FirQuashed">FIR Quashed</option>
        <option value="MF">MF</option>
        <option value="SectionDeleted">Section Deleted</option>
        <option value="Charge_Abated"> Charge Abated</option>
        <option value="Quashed"> Quashed</option>
      </select>
       </div> -->

       <!-- <div class="col-md-2 mt-2" style="float: left; padding-right: 10px;">
        <select  class="form-select" [(ngModel)]="selectedStage" (change)="reliefStage($event)">
          <option value="" disabled>Relief Stage</option>
          <option value="FIR">FIR</option>
          <option value="Chargesheet">Chargesheet</option>
          <option value="TrialStage">Trial</option>
          <option value="FirQuashed,MF,SectionDeleted,Charge_Abated,Quashed">MF, FIR Quashed, Section Deleted, Charge Abated, Quashed</option>
        </select>
       </div>


       <div class="col-md-2 mt-2" style="float: left; padding-right: 10px;">
      <select class="form-select" [(ngModel)]="selectedReliefStatus">
  <option value="" selected>Relief Status</option>
  <ng-container *ngIf="selectedStage !== 'FirQuashed,MF,SectionDeleted,Charge_Abated,Quashed'">
    <option *ngIf="selectedStage === 'FIR'" value="notyetreceived">
      Proposal not yet Received from SP Office
    </option>
    <option value="pending">Relief Pending</option>
    <option value="given">Relief Given</option>
  </ng-container>
</select>

       </div> -->

      <!-- <div class="col-md-4 mt-2">
  <label>Status</label>
  <select class="form-select"
          multiple
          [(ngModel)]="selectedStages"
          (ngModelChange)="filterData()"
          style="height: 200px;">
    <option *ngFor="let stage of allStageOptions" [value]="stage">
      {{ stage }}
    </option>
  </select>
</div> -->
<!-- <div class="col-md-4 mt-2 form-control">
  <div class="custom-multiselect">
    <div class="selected-values" (click)="toggleDropdown()">
      {{ displayText }}
      <span class="arrow">{{ isOpen ? '▲' : '▼' }}</span>
    </div>
    <ul class="dropdown-list" *ngIf="isOpen">
      <li *ngFor="let stage of allStageOptions">
        <label>
          <input 
            type="checkbox" 
            [checked]="isSelected(stage.value)" 
            (change)="toggleSelection(stage.value)">
          {{ stage.label }}
        </label>
      </li>
    </ul>
  </div>
</div> -->

<!-- <div class="col-md-4 mt-2">
  <div class="custom-multiselect">
    <div class="selected-values form-select" (click)="toggleDropdown()">
      {{ displayText }}
    </div>
    <ul class="dropdown-list select-dropdown" *ngIf="isOpen">
      <li *ngFor="let stage of allStageOptions" style="list-style: none !important;">
        <label>
          <input  type="checkbox" 
            [checked]="isSelected(stage.value)" 
            (change)="toggleSelection(stage.value)">
          {{ stage.label }}
        </label>
      </li>
    </ul>
  </div>
</div> -->
<div class="col-md-4 mt-2">
  <div class="custom-multiselect">
    <div class="selected-values form-select" (click)="toggleDropdown()">
      {{ displayText }}
    </div>
    <ul class="dropdown-list select-dropdown" *ngIf="isOpen">
      <li *ngFor="let stage of allStageOptions" style="list-style: none !important;">
        <label>
          <input
            type="checkbox"
            [checked]="isSelected(stage.value)"
            [disabled]="isDisabled(stage.value)"
            (change)="toggleSelection(stage.value)"
          />
          {{ stage.label }}
        </label>
      </li>
    </ul>
  </div>
</div>


      <div class="col-xl-3 col-lg-3 col-md-4 mt-2" style="float: left;">
        <button (click)="SearchList()" class="btn btn-primary btn-sm" style="margin-right:10px;">Apply Filter</button>
        <button (click)="clearfilter()" class="btn btn-secondary btn-sm">Clear</button>
      </div>
    </div>


  </div>

  
  <div class="card-body pt-0">
    <!-- Filters -->
    <!-- <div class="d-flex gap-3 mb-3">
      <select class="form-select" [(ngModel)]="selectedDistrict" (change)="applyFilters()">
        <option value="" selected>Select One</option>
        <option *ngFor="let district of districts" [value]="district">{{ district }}</option>
      </select>

      <select class="form-select" [(ngModel)]="selectedNatureOfOffence" (change)="applyFilters()">
        <option value="" selected>Select One</option>
        <option *ngFor="let nature of naturesOfOffence" [value]="nature">{{ nature }}</option>
      </select>

      <select class="form-select" [(ngModel)]="selectedStatusOfCase" (change)="applyFilters()">
        <option value="" selected>Select One</option>
        <option *ngFor="let status of statusesOfCase" [value]="status">{{ status }}</option>
      </select>

      <select class="form-select" [(ngModel)]="selectedStatusOfRelief" (change)="applyFilters()">
        <option value="" selected>Select One</option>
        <option *ngFor="let reliefStatus of statusesOfRelief" [value]="reliefStatus">
          {{ reliefStatus }}
        </option>
      </select>
    </div> -->

    <div class="card-body pt-0 px-0 overflow-auto" style="width: 100%; overflow-y: auto; overflow-x: auto; min-height: 500px;">
      <table class="table table-striped table-bordered table-hover">
        <thead>
  <tr>
  <th *ngFor="let col of preGroupedColumns" rowspan="2">{{ col.label }}</th>
  <th *ngFor="let groupName of groupOrder"
      [attr.colspan]="groupedBySection[groupName]?.length">
    {{ groupName }}
  </th>
  <th *ngFor="let col of postGroupedColumns" rowspan="2">{{ col.label }}</th>
</tr>

<tr>
  <!-- Render sub-headers inside each group -->
  <ng-container *ngFor="let groupName of groupOrder">
    <th *ngFor="let col of groupedBySection[groupName]" style="background-color: #0da9bc !important; border-radius: 0px !important; border-top:1px solid #fff;">{{ col.label }}</th>
  </ng-container>
</tr>

</thead>
        <tbody>
          <tr *ngFor="let report of paginatedData()">
            <td *ngFor="let column of displayedColumns" [hidden]="!column.visible">
              <ng-container [ngSwitch]="column.field">

              
                <!-- Default Case -->
                <span *ngSwitchDefault>{{ report[column.field] }}</span>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
      <!-- Show message if data is loading -->
      <div *ngIf="loading" class="alert alert-warning">Loading...</div>
      <!-- Show message if filtered data is empty -->
      <div *ngIf="filteredData.length === 0 && !loading" class="alert alert-warning">No FIR data available.</div>
    <div class="mt-3 float-right">
  <button class="btn btn-primary me-2 py-2 px-3" (click)="onBtnExport()">
    <i class="fas fa-download me-1"></i> Excel
  </button></div>
      <!-- <button style="margin-left: 5px;" class="btn btn-primary mt-3" (click)="onBtnExport()">Download as Excel</button> -->
      <ul class="pagination">

      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="goToFirstPage()">Start</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="previousPage()">Previous</button>
      </li>

      <li class="page-item" *ngFor="let pageNum of totalPagesArray()">
        <button class="page-link" (click)="goToPage(pageNum)" [class.active]="currentPage === pageNum">
          {{ pageNum }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="!hasNextPage()">
        <button class="page-link" (click)="nextPage()">Next</button>
      </li>

      <li class="page-item" [class.disabled]="!hasNextPage()">
        <button class="page-link" (click)="goToLastPage()">End</button>
      </li>

      <span class="ms-3 mt-2">
        Page {{ currentPage }} of {{ totalPages }} ({{ totalRecords }} records)
      </span>
    </ul>

    </div>

  </div>
</div>

<style>
  .loader-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.8);
  z-index: 99;
  display: flex;
  justify-content: center;
  align-items: center;
}

  .tooltip-container {
    position: relative;
    display: inline-block;
  }

  .tooltip-text {
    visibility: hidden;
    background-color: #333;
    color: #fff;
    text-align: center;
    padding: 6px 8px;
    border-radius: 5px;
    position: absolute;
    top: -35px;
    /* Position above the input */
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .tooltip-container:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }
  .select-dropdown{
    position: absolute;
    border: 1px solid #ccc;
    padding: 10px 24px 10px 10px !important;
    background: #fff;
}
</style>