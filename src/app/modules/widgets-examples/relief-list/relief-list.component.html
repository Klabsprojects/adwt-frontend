<div class="card">
  <div class="card-header border-0 pt-6">
  <div class="card-title">
    <div class="d-flex align-items-center position-relative my-1">
      <i class="fas fa-search fs-3 position-absolute ms-5"></i>
      <input type="text" [(ngModel)]="searchText" class="form-control form-control-solid w-250px ps-12"
        placeholder="Search FIR" />
    </div>
  </div>


    <div class="card-toolbar d-flex align-items-center gap-3">



<mat-form-field appearance="outline" class="w-250px">
  <mat-label>Select Filters</mat-label>
  <mat-select [multiple]="true"
              [value]="activeFilters"
              (selectionChange)="onFilterSelectionChange($event)">
    <mat-option *ngFor="let filter of filterFields" [value]="filter.key">
      {{ filter.label }}
    </mat-option>
  </mat-select>
</mat-form-field>



      <!-- Visible Columns with Drag-and-Drop -->
      <mat-form-field appearance="outline" class="w-250px">
        <mat-label>Selected Columns</mat-label>
        <mat-select>
          <div cdkDropList (cdkDropListDropped)="dropColumn($event)">
            <mat-option *ngFor="let column of displayedColumns" cdkDrag>
              <div class="d-flex align-items-center gap-2">
                <mat-checkbox
                  [checked]="column.visible"
                  (change)="toggleColumnVisibility(column)">
                  {{ column.label }}
                </mat-checkbox>
                <i class="fas fa-bars drag-handle" cdkDragHandle></i>
              </div>
            </mat-option>
          </div>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
<!-- Filters -->




  <div class="card-body">
     <div class="loader-overlay" *ngIf="loader">
      <mat-spinner></mat-spinner>
    </div>

    <div class="row d-flex mb-3 align-items-center outer pt-4 pb-2 px-3 m-0">
      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('city')">
        <select class="form-select" [(ngModel)]="selectedDistrict" (change)="loadPoliceStations(selectedDistrict)">
          <option value="" selected disabled>Police City</option>
          <option *ngFor="let district of districts" [value]="district">{{ district }}</option>
        </select>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('zone')">
        <select class="form-select" [(ngModel)]="selectedPoliceZone">
            <option value="" selected hidden disabled>Police Zone</option>
            <option *ngFor="let item of policeZones" [value]="item">{{ item }}</option>
          </select>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="Parsed_UserInfo.access_type != 'District'  && isVisible('range')">
        <select  class="form-select" [(ngModel)]="selectedPoliceRange">
            <option value="" selected hidden disabled>Police Range</option>
            <option *ngFor="let item of policeRanges" [value]="item.police_range">{{ item.police_range }}</option>
          </select>
      </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="Parsed_UserInfo.access_type != 'District'  && isVisible('revenueDistrict')">
      <select  class="form-select"  [(ngModel)]="selectedRevenue_district" (change)="onDistrictChange($event)">
          <option value="" selected hidden disabled>Revenue District</option>
          <option *ngFor="let item of revenueDistricts" [value]="item.revenue_district">{{ item.revenue_district }}
          </option>
        </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('station')">
    <select class="form-select" [(ngModel)]="selectedPoliceStation">
      <option value="" selected disabled>Police Station</option>
      <option *ngFor="let station of policeStationlist"  [value]="station">{{ station }}</option>
    </select>
  </div>

      
    <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('community')">
       <select  class="form-select" [(ngModel)]="selectedCommunity" (change)="onCommunityChange($event)"  >
          <option value="" disabled>Community</option>
          <option *ngFor="let community of communitiesOptions" [value]="community">{{ community }}</option>
        </select>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('caste')">
       <select  class="form-select" [(ngModel)]="selectedCaste">
          <option value="" disabled>Caste</option>
          <option *ngFor="let caste of casteOptions" [value]="caste">{{ caste }}</option>
      </select>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('registeredYear')">
       <select  class="form-select" [(ngModel)]="RegistredYear">
        <option value="" selected hidden disabled>Year of Registration</option>
        <option *ngFor="let item of years" [value]="item">
          {{ item }}
        </option>
      </select>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('regDate')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="startDate"  class="form-control" placeholder="Start Date">
        <span class="tooltip-text">Date of Registration From Date</span>
      </div>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('regDate')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="endDate"  class="form-control" placeholder="End Date">
        <span class="tooltip-text">Date of Registration To Date</span>
      </div>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('createdAt')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="CreatedATstartDate"  class="form-control" placeholder="Start Date">
        <span class="tooltip-text">Created AT From Date</span>
      </div>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('createdAt')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="CreatedATendDate"  class="form-control" placeholder="End Date">
        <span class="tooltip-text">Created AT To Date</span>
      </div>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('modifiedAt')">
       <div class="tooltip-container">
        <input type="date" [(ngModel)]="ModifiedATstartDate"  class="form-control" placeholder="Start Date">
        <span class="tooltip-text">Modified AT From Date</span>
      </div>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('modifiedAt')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="ModifiedATDate"  class="form-control" placeholder="End Date">
        <span class="tooltip-text">Modified AT To Date</span>
      </div>
      </div>

  <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('dataEntryStatus')">
      <select class="form-select" [(ngModel)]="selectedDataEntryStatus">
        <option value="" selected  disabled>Data Entry Status</option>
        <option value="0">FIR Draft</option>
        <option value="1">Step 1 Completed</option>
        <option value="2">Step 2 Completed</option>
        <option value="3">Step 3 Completed</option>
        <option value="4">Step 4 Completed</option>
        <option value="5">Completed | FIR Stage</option>
        <option value="6">Charge Sheet Completed</option>
        <option value="7">Trial Stage Completed</option>
      </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('status')">
      <select class="form-select" [(ngModel)]="selectedStatusOfCase">
        <option value="" selected hidden disabled>Status of Case</option>
        <option value="UI">UI</option>
        <option value="PT">PT</option>
        <option value="Convicted">Conviction</option>
        <option value="Acquitted">Acquitted</option>
        <option value="FirQuashed">FIR Quashed</option>
        <option value="MF">MF</option>
        <option value="SectionDeleted">Section Deleted</option>
        <option value="Charge_Abated"> Charge Abated</option>
        <option value="Quashed"> Quashed</option>
      </select>
    </div>

     <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('offenceGroup')">
      <select class="form-select" [(ngModel)]="selectedOffenceGroup">
        <option value="" selected hidden disabled>Nature of Case</option>
        <option *ngFor="let item of offenceGroupsList" [value]="item">
          {{ item }}
        </option>
      </select>
      </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('sectionOfLaw')">
      <select class="form-select" [(ngModel)]="selectedSectionOfLaw">
        <option value="" selected hidden disabled>Section of Law</option>
        <option *ngFor="let section of sectionOfLaw" [value]="section.offence_act_name">{{ section.offence_act_name }}</option>
      </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('court')">
      <select class="form-select" [(ngModel)]="selectedCourt">
        <option value="" selected hidden disabled>Court</option>
        <option *ngFor="let item of courtList" [value]="item">
          {{ item }}
        </option>
      </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('convictionType')">
      <select class="form-select" [(ngModel)]="selectedConvictionType">
        <option value="" selected hidden disabled>Conviction Type</option>
        <option value="Life Sentence">Life Sentence</option>
        <option value="Below 5 years imprisonment">Below 5 years imprisonment</option>
        <option value="Others">Others</option>
        <option value="Below 1 year imprisonment">Below 1 year imprisonment</option>
        <option value="Above 20 Years imprisonment">Above 20 Years imprisonment</option>
        <option value="Double Life Sentence">Double Life Sentence</option>
        <option value="Above 10 Years imprisonment">Above 10 Years imprisonment</option>
        <option value="Above 5 Years imprisonment">Above 5 Years imprisonment</option>
      </select>
    </div>

   <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('chargeSheetDate')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="selectedChargeSheetFromDate"  class="form-control" placeholder="End Date">
        <span class="tooltip-text">Chargesheet From Date</span>
      </div>
      </div>

      <div class="col-xl-3 col-lg-3 col-md-4 mb-3" *ngIf="isVisible('chargeSheetDate')">
      <div class="tooltip-container">
        <input type="date" [(ngModel)]="selectedChargeSheetToDate"  class="form-control" placeholder="End Date">
        <span class="tooltip-text">Chargesheet To Date</span>
      </div>
      </div>


    <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('legal')">
      <select class="form-select" [(ngModel)]="selectedLegal">
        <option value="" selected hidden disabled>Has Legal Opnion Obtained</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('fitCase')">
      <select class="form-select" [(ngModel)]="selectedCase">
        <option value="" selected hidden disabled>Is the Case fit for Appeal</option>
        <option value="yes">Yes</option>
         <option value="no">No</option>
      </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('filedBy')">
      <select class="form-select" [(ngModel)]="selectedFiled">
        <option value="" selected hidden disabled>Who has filed the appeal</option>
        <option value="victim">Victim</option>
        <option value="government">Government</option>
      </select>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-4 mb-3"  *ngIf="isVisible('appealCourt')">
      <select class="form-select" [(ngModel)]="selectedAppeal">
        <option value="" selected hidden disabled>Appeal Court</option>
        <option value="High Court">High Court</option>
        <option value="Supreme Court">Supreme Court</option>
      </select>
    </div>

    <div class="col-md-4 mt-2" *ngIf="isVisible('selectedStatus')">
  <div class="custom-multiselect">
    <div class="selected-values form-select" (click)="toggleDropdown()">
      {{ displayText }}
    </div>
    <ul class="dropdown-list select-dropdown" *ngIf="isOpen">
      <li *ngFor="let stage of allStageOptions" style="list-style: none !important;">
        <label>
          <input  type="checkbox" 
            [checked]="isSelected(stage.value)" 
            (change)="toggleSelection(stage.value)">
          {{ stage.label }}
        </label>
      </li>
    </ul>
  </div>
</div>


<div class="col-xl-3 col-lg-3 col-md-4 mb-3">
       <button  (click)="SearchList()" class="btn btn-primary btn-sm">Apply Filters</button>
      <button  (click)="clearfilter()" class="btn btn-secondary btn-sm" style="margin-left: 5px;">Clear</button>
      </div>
</div>

    <!-- Show message if FIR list is empty -->
    <div *ngIf="firList.length === 0" class="alert alert-warning">
      No Relif data available.
    </div>

    <!-- Table displaying FIRs -->
    <div style="width: 100%; overflow-y: auto; overflow-x: auto; min-height: 500px; padding-right:30px !important;">
    <table *ngIf="this.firList.length > 0" class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th *ngFor="let column of displayedColumns" [hidden]="!column.visible">
            {{ column.label }}
            <i
              *ngIf="column.sortable"
              class="fas"
              [ngClass]="getSortIcon(column.field)"
              (click)="sortTable(column.field)"
            ></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let fir of paginatedFirList(); let i = index">
         
          <td *ngFor="let column of displayedColumns" [hidden]="!column.visible">
            <ng-container [ngSwitch]="column.field">
              <span *ngSwitchCase="'sl_no'">{{ (currentPage - 1) * pageSize + i + 1 }}</span>
              <span *ngSwitchCase="'fir_number'">{{ fir.fir_number }}</span>
              <span *ngSwitchCase="'police_city'">{{ fir.police_city }}</span>
              <span *ngSwitchCase="'police_station'">{{ fir.police_station }}</span>
              <span *ngSwitchCase="'date_of_reporting'">{{fir.date_of_reporting | date:'dd-MM-yyyy'}}</span>
              <span *ngSwitchCase="'created_by'">{{ fir.created_by || '' }}</span>
              <span *ngSwitchCase="'created_at'">{{ fir.created_at | date: 'dd-MM-yyyy' }}</span>
              <span *ngSwitchCase="'status'">
                <span class="badge" [ngClass]="getStatusBadgeClass(fir.status)">
                  {{ getStatusText(fir.status, fir.relief_status) }}
                </span>
              </span>
             

              <span *ngSwitchCase="'actions'">
                  <button *ngIf="fir.status > 4"
                  class="btn btn-primary btn-sm"
                  (click)="navigateToRelief(fir.fir_id)"
                >
                  Relief Process
                </button>
              </span>


            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
    </div>
    <!-- Pagination Controls -->
      <ul class="pagination">

      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="goToFirstPage()">Start</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="previousPage()">Previous</button>
      </li>

      <li class="page-item" *ngFor="let pageNum of totalPagesArray()">
        <button class="page-link" (click)="goToPage(pageNum)" [class.active]="currentPage === pageNum">
          {{ pageNum }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="!hasNextPage()">
        <button class="page-link" (click)="nextPage()">Next</button>
      </li>

      <li class="page-item" [class.disabled]="!hasNextPage()">
        <button class="page-link" (click)="goToLastPage()">End</button>
      </li>

      <span class="ms-3 mt-2">
        Page {{ currentPage }} of {{ totalPages }} ({{ totalRecords }} records)
      </span>
    </ul>
  </div>
</div>
<style>
    .select-dropdown{
    position: absolute;
    border: 1px solid #ccc;
    padding: 10px 24px 10px 10px !important;
    background: #fff;
}
</style>