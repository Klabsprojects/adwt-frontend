<style>
  .dropzone {
    border: 2px dashed #007bff;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    position: relative;
  }
  .file-over {
    background-color: #f0f8ff;
  }
  .file-preview {
    display: inline-block;
    margin: 10px;
    text-align: center;
  }
  .file-preview-img {
    max-width: 100px;
    max-height: 100px;
    object-fit: cover;
  }
  .remove-file {
    background-color: #ff0000;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    margin-top: 5px;
  }
  .remove-file:hover {
    background-color: #cc0000;
  }
  .file-input-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    opacity: 0;
    z-index: -1;
  }
</style>


<div class="card border-primary">
<div class="loader-overlay" *ngIf="loader">
<mat-spinner></mat-spinner>
</div>
  <div class="card-header text-center py-4 bg-light">
    <h2 class="mb-0 fw-bold text-dark" style="font-size: 1.75rem;">
      {{ mainStep === 1 ? 'FIR Stage' : mainStep === 2 ? 'Chargesheet Stage' : 'Trial Stage' }} {{ mainStep === 1 ? tabs[step - 1].label : '' }}
    </h2>
  </div>
  <div class="card-body">
    <ul class="stepper-tabs">
      <li class="stepper-item" *ngFor="let tab of ['FIR Stage', 'Chargesheet Stage', 'Trial Stage']; let i = index" [ngClass]="{ 'active': mainStep === i + 1, 'completed': mainStep > i + 1 }" (click)="navigateToMainStep(i + 1)">
        <div class="step-content">
          <span class="step-label">{{ tab }}</span>
        </div>
      </li>
    </ul>
    <ul class="stepper" *ngIf="mainStep === 1">
      <li class="step-item" 
        *ngFor="let tab of tabs; let i = index"
        [ngClass]="{
            'active': step === i + 1,
            'completed': step > i + 1
        }"
        (click)="navigateToStep(i + 1)">
        <div class="step-circle">{{ i + 1 }}</div>
        <div class="step-label">{{ tab.label }}</div>
        <div *ngIf="i < tabs.length - 1" class="step-line"></div>
      </li>
    </ul>
  </div>  
  <div class="card-body border-top">
    <form [formGroup]="firForm" id="firForm" enctype="multipart/form-data" method="POST">
      <div *ngIf="mainStep === 1 && step === 1" class="form-step">
        <div class="location-details mb-4">
          <h5>Location Details</h5>

          <div class="row">
            <div class="col-md-6 col-lg-3 mb-3">
              <label for="policeCity" class="form-label required">1. Police City / District</label>
              <select id="policeCity" class="form-select" formControlName="policeCity" (change)="onCityChange($event)" required>
                <option value="" disabled>Select one</option>
                <option *ngFor="let city of police_Cities_data" [value]="city">{{ city }}</option>
              </select>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
              <label for="policeZone" class="form-label required">2. Police Zone</label>
              <select id="policeZone" class="form-select" formControlName="policeZone">
                <option value="" disabled>Select one</option>
                <option *ngFor="let zone of policeZones" [value]="zone">{{ zone }}</option>
              </select>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
              <label for="policeRange" class="form-label required">3. Police Range</label>
              <select id="policeRange" class="form-select" formControlName="policeRange">
                <option value="" disabled>Select one</option>
                <option *ngFor="let range of policeRanges[0]" [value]="range">{{ range }}</option>
              </select>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
              <label for="revenueDistrict" class="form-label required">4. Revenue District</label>
              <select id="revenueDistrict" class="form-select" formControlName="revenueDistrict">
                <option value="" disabled>Select one</option>
                <option *ngFor="let district of revenueDistricts[0]" [value]="district">{{ district }}</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="stationName" class="form-label required">5. Police Station Name</label>
              <select id="stationName" class="form-select" formControlName="stationName" (change)="getStationName($event)">
                <option value="" disabled>Select Police Station</option>
                <option *ngFor="let station of policeStations" [value]="station">{{ station }}</option>
              </select>
              
            </div>
            
          </div>
          <div class="row">
            <h5>Investigating Officer Details</h5>
            <!-- <div class="col-md-6 col-lg-4 mb-3">
              <label for="officerName" class="form-label">6.Name of the Investigating Officer  (IO)*</label>
              <input id="officerName" type="text" class="form-control" formControlName="officerName" placeholder="Enter Officer Name" (keypress)="allowOnlyLetters($event)" required/>
              <small class="text-danger" *ngIf="firForm.get('officerName')?.invalid && firForm.get('officerName')?.touched">Please enter a valid name.</small>
            </div> -->
            <div class="col-md-6 col-lg-4 mb-3">
              <label for="officerName" class="form-label required">6. Name of the Investigating Officer (IO)</label>
              <input id="officerName" type="text" class="form-control" formControlName="officerName"
              placeholder="Enter Officer Name" required/>
              <!-- <small class="text-danger" *ngIf="firForm.get('officerName')?.invalid && firForm.get('officerName')?.touched">
                Please enter a valid name.
              </small> -->
            </div>

            <div class="col-lg-4">
              <label for="complaintReceived" class="form-label w-100 float-left">6a. Complaint Received</label>
              <div class="d-flex align-items-center justify-content-start">
                <div class="form-check float-left">
                  <input  type="radio" class="radio-button" formControlName="complaintReceivedType" id="written" value="Written">
                  <label class="form-check-label pl-2" for="written"> Written</label>
                </div>
                <div class="form-check float-left">
                  <input  type="radio" class="radio-button" formControlName="complaintReceivedType" id="oral" value="Oral">
                  <label class="form-check-label  pl-2" for="oral"> Oral </label>
                </div>
              </div>
            </div>

            <div class="col-md-6 col-lg-4 mb-3">
              <label for="complaintRegisteredBy" class="form-label">6b. Complaint Registered By</label>
              <select id="complaintRegisteredBy" class="form-select" formControlName="complaintRegisteredBy">
                <option value="" selected>Select </option>
                <option value="Inspector">Inspector</option>
                <option value="SI/ SSI">SI/ SSI</option>
                <option value="ORS">ORS</option>
              </select>
            </div>

            <div class="col-md-6 col-lg-4 mb-3">
              <label for="officerPhone" class="form-label">6c. Complaint Receiver Name</label>
              <input  type="text" class="form-control"  placeholder="Enter Complaint Receiver Name" formControlName="complaintReceiverName" />
            </div>
            <div class="col-md-6 col-lg-4 mb-3">
              <label for="officerDesignation" class="form-label required">7.Designation of the Investigating Officer</label>
              <select id="officerDesignation" class="form-select" formControlName="officerDesignation" required (change)="getDesignation($event)">
                <option value="" disabled>Select Designation</option>
                <option value="DSP">DSP</option>
                <option value="ACP">ACP</option>
                <option value="ASP">ASP</option>
                <option value="ADSP">ADSP</option>
                <option value="Others">Others</option>
              </select>
              <small class="text-danger" *ngIf="firForm.get('officerDesignation')?.invalid && firForm.get('officerDesignation')?.touched">Please select a designation.</small>
            </div>

            <div class="col-md-6 col-lg-4 mb-3" *ngIf="showOtherDesignation">
              <label for="officerPhone" class="form-label">7a. Designation Name</label>
              <input  id="otherDesignation" type="text" class="form-control" [value]="otherDesignationValue" placeholder="Enter Designation Name" (input)="getDesignationName($event)" />
            </div>

            <div class="col-md-6 col-lg-4 mb-3">
              <label for="officerPhone" class="form-label required">8. Phone Number of the Investigating Officer</label>
              <input id="officerPhone" type="text" class="form-control" formControlName="officerPhone" placeholder="Enter Phone Number" (keypress)="allowOnlyNumbers($event)" maxlength="10" required/>
              <small class="text-danger" *ngIf="firForm.get('officerPhone')?.invalid && firForm.get('officerPhone')?.touched">Please enter a valid 10-digit phone number.</small>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-warning me-2" [disabled]="!SubmitButton" (click)="saveAsDraft()">Save as Draft</button>
        <button type="button" class="btn btn-primary"  [disabled]="!isStep1Valid() || !SubmitButton" (click)="nextStep()">Next</button>
      </div>
      <div *ngIf="mainStep === 1 && step === 2" class="form-step">
        <h3 class="mb-4">Step 2: Offence Information</h3>
        <div class="row mb-3">
          <div class="row mb-3">
            <div class="col-md-5 mb-3">
              <label for="firNumber" class="form-label required">9. FIR Number</label>
              <div class="input-group">
                <input 
                type="text" 
                id="firNumber" 
                class="form-control"
                formControlName="firNumber"
                placeholder="Enter FIR Number"
                required
                (keypress)="validateFirNumber($event)"
            />
                <span class="input-group-text">/</span>
                <!-- <select id="firNumberSuffix" class="form-select" formControlName="firNumberSuffix" required>
                  <option value="" disabled selected>Select Year</option>
                  <option *ngFor="let year of yearOptions" [value]="year">{{ year }}</option>
                </select> -->
                <!-- FIR Number Suffix (ng-select for year selection) -->
                <ng-select 
                    id="firNumberSuffix" 
                    class="form-select" 
                    [items]="yearOptions" 
                    bindLabel="year" 
                    bindValue="year"
                    formControlName="firNumberSuffix" 
                    [searchable]="true"
                    [clearable]="false"
                    [placeholder]="firForm.get('firNumberSuffix')?.value ? '' : 'Select Year'"
                    required>
                </ng-select>
              </div>
              <small *ngIf="!isFirValid('firNumber', 'firNumberSuffix')" class="text-danger d-block mt-1">Please Follow the format "12/2024".</small>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <label for="dateOfOccurrence" class="form-label">10. From Date of Occurrence</label>
            <input type="date" id="dateOfOccurrence" class="form-control" formControlName="dateOfOccurrence" [max]="today" />
          </div>
          <div class="col-md-4 mb-3">
            <label for="todateOfOccurrence" class="form-label">10a. To Date of Occurrence</label>
            <input
                type="date"
                id="todateOfOccurrence"
                class="form-control"
                formControlName="date_of_occurrence_to"
                [max]="today"
            />
        </div>
          <div class="col-md-4 mb-3">
            <label for="timeOfOccurrence" class="form-label">11. From Time of Occurrence</label>
            <input type="time" id="timeOfOccurrence" class="form-control" formControlName="timeOfOccurrence" />
          </div>
          <div class="col-md-4 mb-3">
            <label for="totimeOfOccurrence" class="form-label">11a. To Time of Occurrence</label>
            <input type="time" id="totimeOfOccurrence" class="form-control" formControlName="time_of_occurrence_to"/>
        </div>
          <div class="col-md-4 mb-3">
            <label for="placeOfOccurrence" class="form-label required">12. Place of Occurrence</label>
            <input type="text" id="placeOfOccurrence" class="form-control" formControlName="placeOfOccurrence" placeholder="Place of Occurrence" style="text-transform: capitalize;" required />
          </div>
          <div class="col-md-6 col-lg-4 mb-3">
            <label for="is_case_altered" class="form-label">13. Is Case altered?</label>
            <select id="is_case_altered" class="form-select" formControlName="is_case_altered">
              <option value="No" selected>No</option>
              <option value="Yes">Yes</option>
            </select>
          </div>
          <!-- <div class="col-md-4 mb-3">
            <label for="dateOfRegistration" class="form-label">13a. Date of Case Registration *</label>
            <input type="date" id="dateOfRegistration" class="form-control" formControlName="dateOfRegistration" [max]="today" required />
             <div *ngIf="firForm.hasError('invalidRegistrationDateTime') && firForm.touched" class="text-danger">
              Date of Case Registration cannot be earlier than the Date of Occurrence.
            </div>
          </div> -->

           <div class="col-md-4 mb-3">
                      <label for="dateOfRegistration" class="form-label required">13a. Date of Case Registration</label>
                      <input
                          type="date"
                          id="dateOfRegistration"
                          class="form-control"
                          formControlName="dateOfRegistration"
                          [max]="today"
                          required
                      />
                      <div *ngIf="firForm.hasError('invalidRegistrationDateTime') && firForm.touched" class="text-danger">
                          Date of Case Registration cannot be earlier than the Date of Occurrence.
                      </div>
                  </div>

          <div *ngIf="firForm.get('is_case_altered')?.value === 'Yes'" class="col-md-4 mb-3">
            <label for="altered_date" class="form-label required">13b. Date of Case Alteration</label>
            <input
                type="date"
                id="altered_date"
                class="form-control"
                formControlName="altered_date"
                [max]="today"
                required
            />
        </div>
          <div class="col-md-4 mb-3">
            <label for="timeOfRegistration" class="form-label required">14. Time of Case Registration</label>
            <input type="time" id="timeOfRegistration" class="form-control" formControlName="timeOfRegistration" required />
          </div>
        </div>
        <div class="mt-4">
          <button type="button" class="btn btn-warning me-2" [disabled]="!SubmitButton" (click)="saveAsDraft()">Save as Draft</button>
          <button type="button" class="btn btn-secondary me-2" (click)="previousStep()">Previous</button>
          <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!isStepValid() || !SubmitButton">Next</button>
        </div>
      </div>
      <div *ngIf="mainStep === 1 && step === 3" class="form-step">
        <h3 class="mb-4">Step 3: Victim Information</h3>
        <div class="row mb-4" formGroupName="complainantDetails">
          <div class="col-md-4 mb-3">
            <label for="nameOfComplainant" class="form-label required">15. Name of Complainant</label>
            <input type="text" id="nameOfComplainant" class="form-control" formControlName="nameOfComplainant" placeholder="Enter Name of Complainant" required pattern="^[A-Za-z\s]*$" style="text-transform: capitalize;" />
            <!-- <div *ngIf="isNameInvalid()" class="text-danger mt-1">Please enter a valid name (letters only).</div> -->
          </div>
          <div class="col-md-4 mb-3">
            <label for="mobileNumberOfComplainant" class="form-label required">16. Mobile Number of Complainant</label>
            <input type="text" id="mobileNumberOfComplainant" class="form-control" formControlName="mobileNumberOfComplainant" placeholder="Enter Mobile Number" required maxlength="10" pattern="^[0-9]{10}$" (keypress)="allowOnlyNumbers($event)" />
            <div *ngIf="isPhoneInvalid(0, 'complainant')" class="text-danger mt-1">Please enter a valid 10-digit mobile number.</div>
          </div>
          <div class="col-md-4 mb-3">
            <label for="isVictimSameAsComplainant" class="form-label required">17. Is the victim same as complainant?</label>
            <select id="isVictimSameAsComplainant" class="form-select" formControlName="isVictimSameAsComplainant" required>
              <option value="" disabled>Select</option>
              <option [value]="true">Yes</option>
              <option [value]="false">No</option>
            </select>
          </div>
          <div class="col-md-2 mb-3">
            <label for="numberOfVictims" class="form-label required">18. Number of Victims</label>
            <!-- <select id="numberOfVictims" class="form-select" formControlName="numberOfVictims" (change)="onNumberOfVictimsChange()" required>
              <option value="" disabled>Select</option>
              <option *ngFor="let num of victimCountArray" [value]="num">{{ num }}</option>
            </select> -->
            <input type="number" class="form-control" formControlName="numberOfVictims" placeholder="Enter Accused Number" (change)="onNumberOfVictimsChange()"  required />
          </div>
        </div>
        <div formArrayName="victims">
          <div *ngFor="let victim of victims.controls; let i = index" [formGroupName]="i" class="victim-entry mb-4 card border-primary">
            <div style="align-items: center;" class="card-header bg-primary">
              <h5 class="text-white mt-3">#{{ i + 1 }} Victim Details</h5>
                <button  
                    style="height: 40px;"
                    type="button" 
                    class="btn btn-danger btn-sm" 
                    (click)="deleteVictim(i, victim.get('victim_id')?.value)"
                    [title]="'Delete victim #' + (i + 1)">
                    <i class="fas fa-trash"></i> Delete
                  </button>
            </div>
            <div class="card-body">



              <div class="row">



                <div class="col-md-4 mb-3">
                  <label for="victimAge-{{i}}" class="form-label required">19. Age of the Victim</label>
                  <input type="number" id="victimAge-{{i}}" class="form-control" formControlName="age" placeholder="Enter victim's age" (input)="onVictimAgeChange(i)" required />
                </div>



                <div class="col-md-4 mb-3">
                  <label for="victimName-{{ i }}" class="form-label required">20. Name of the Victim</label>
                  <input type="text" 
                      id="victimName-{{ i }}" 
                      class="form-control" 
                      formControlName="name" 
                      placeholder="Enter victim's name" 
                      required 
                      (change)="updateVictimNames()"  
                      (input)="updateVictimNames()" 
                      [readonly]="victims.at(i)?.get('age')?.value < 18" />
                  <!-- <input type="text" id="victimName-{{ i }}" class="form-control" formControlName="name" placeholder="Enter victim's name" required (change)="updateVictimNames()"  (input)="updateVictimNames()" style="text-transform: capitalize;" /> -->
                  <!-- <div *ngIf="isVictimNameInvalid(i)" class="text-danger mt-1">Please enter a valid name (letters only).</div> -->
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimGender{{ i }}" class="form-label required">21. Gender of the Victim</label>
                  <select [id]="'victimGender' + i" class="form-select" formControlName="gender" required>
                    <option value="" disabled>Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Transgender">Transgender</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimMobile{{ i }}" class="form-label required">22. Mobile Number of the Victim</label>
                  <input type="text" [id]="'victimMobile' + i" class="form-control" formControlName="mobileNumber" placeholder="Enter Mobile Number" maxlength="10" (keypress)="allowOnlyNumbers($event)" />
                  <div *ngIf="isVictimMobileInvalid(i)" class="text-danger mt-1">Please enter a valid 10-digit mobile number.</div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimAddress{{ i }}" class="form-label">23. Address of the Victim</label>
                  <input type="text" [id]="'victimAddress' + i" class="form-control" formControlName="address" placeholder="Enter Address" style="text-transform: capitalize;" />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimPincode{{ i }}" class="form-label">24. Pincode</label>
                  <input type="text" [id]="'victimPincode' + i" class="form-control" formControlName="victimPincode" placeholder="Enter Pincode" maxlength="6" (keypress)="allowOnlyNumbers($event)" />
                  <!-- <div class="text-danger mt-1">Please enter a valid 6-digit pincode.</div> -->
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimCommunity{{ i }}" class="form-label required">25. Community of the Victim</label>
                  <select [id]="'victimCommunity' + i" class="form-select" (change)="onCommunityChange($event, i)"   formControlName="community" required>
                    <option value="" disabled>Select Community</option>
                    <option value="SC">SC</option>
                    <!-- <option value="SCA">SCA</option> -->
                    <option value="ST">ST</option>
                  </select>
                  <!-- <ng-select 
                    [id]="'victimCommunity' + i"
                    class="form-select"
                    [items]="communitiesOptions"
                    bindLabel="label"
                    bindValue="value"
                    formControlName="community"
                    [searchable]="true"
                    [clearable]="false"
                    [placeholder]="victim.get('community')?.value ? '' : 'Select Community'"
                    (change)="onCommunityChange($event, i)"  
                    required>
                  </ng-select> -->
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimCaste{{ i }}" class="form-label required">25. Caste of the Victim</label>
                  <select [id]="'victimCaste' + i" class="form-select" formControlName="caste" required>
                    <option value="" disabled>Select Caste</option>
                    <!-- <option *ngFor="let caste of scstSectionsOptions" [value]="caste">{{ caste }}</option> -->
                    <option *ngFor="let caste of victims.at(i).get('availableCastes')?.value" [value]="caste">
                      {{ caste }}
                    </option>
                  </select>
                  <!-- <ng-select  
                    [id]="'victimCaste' + i"
                    class="form-select"
                    [items]="victims.at(i).get('availableCastes')?.value"
                    bindLabel="caste"
                    bindValue="caste"
                    formControlName="caste"
                    [searchable]="true"
                    [clearable]="false"
                    [placeholder]="victims.at(i).get('caste')?.value ? '' : 'Select Caste'"
                    required>
                  </ng-select> -->
                </div>
                <div class="col-md-4 mb-3">
                  <label for="victimGuardian{{ i }}" class="form-label required">27. Name of the Victim's Guardian</label>
                  <input type="text" [id]="'victimGuardian' + i" class="form-control" formControlName="guardianName" placeholder="Enter Guardian's Name" required style="text-transform: capitalize;" />
                  <!-- <div *ngIf="isGuardianNameInvalid(i)" class="text-danger mt-1">Please enter a valid name (letters only).</div> -->
                </div>
                <div class="col-md-6 mb-3">
                  <label for="isNativeDistrictSame{{ i }}" class="form-label d-block required">28. Is the victim’s native district the same as the scene of crime occurrence?</label>
                  <select [id]="'isNativeDistrictSame' + i" class="form-select" formControlName="isNativeDistrictSame" (change)="onNativeDistrictSameChange(i)" required>
                    <option value="" disabled>Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3" *ngIf="victims.at(i).get('isNativeDistrictSame')?.value === 'no'">
                  <label for="victimNativeDistrict{{ i }}" class="form-label required">29. Victim's Native District</label>
                  <select [id]="'victimNativeDistrict' + i" class="form-select" formControlName="nativeDistrict" required>
                     <option value="" disabled>Select District</option>
                     <option *ngFor="let district of courtDistricts" [value]="district">{{ district }}</option>
                  </select>
                </div>
                <!-- <div class="col-md-6 mb-3">
                  <label class="form-label">30. Nature of offence committed against the victim *</label>
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Select options</mat-label>
                    <mat-select formControlName="offenceCommitted" multiple (selectionChange)="onOffenceCommittedChange($event, i)">
                      <mat-option *ngFor="let option of offenceOptions" [value]="option.offence_name">
                        {{option.offence_act_name}} 
                        <span *ngIf="option.offence_act_name != '100 percent incapacitation' && option.offence_act_name != 'Disability: Incapacitation greater than 50' && option.offence_act_name != 'Disability: Incapacitation less than 50' && option.offence_act_name != 'Rape'  && option.offence_act_name != 'Gang Rape'  && option.offence_act_name != 'Murder'">- {{ option.offence_name }}</span>
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div> -->

                <!-- <div class="col-md-12 mb-3">
                  <label class="form-label">30. Sections of the SC/ST POA Act Invoked for the Offence *</label>
                  <ng-select
                  class="form-select"
                  [items]="offenceOptions"
                  bindLabel="offence_name"
                  bindValue="offence_name"
                  [multiple]="true"
                  formControlName="offenceCommitted"
                  [searchable]="true"
                  [clearable]="false"
                  [placeholder]="victims.at(i).get('offenceCommitted')?.value?.length ? '' : 'Select offences'"
                  (change)="onOffenceCommittedChange($event, i)"
                  [id]="'victimOffence' + i"
                  required> -->

                  <!-- Custom selected label -->
                  <!-- <ng-template ng-label-tmp let-item="item">
                    <span>{{ item.offence_act_name }}</span>
                    <span *ngIf="!isActExcluded(item.offence_act_name)"> - {{ item.offence_name }}</span>
                  </ng-template> -->

                  <!-- Custom dropdown option -->
                  <!-- <ng-template ng-option-tmp let-item="item">
                    {{ item.offence_act_name }}
                    <span *ngIf="!isActExcluded(item.offence_act_name)"> - {{ item.offence_name }}</span>
                  </ng-template>
                </ng-select>
                </div> -->

                <div class="col-md-12 mb-3">
                  <label class="form-label required">30. Sections of the SC/ST POA Act Invoked for the Offence</label>

                  
                <ng-select
                class="form-select"
                [items]="offenceOptions"
                bindLabel="offence_name"
                bindValue="offence_name"
                [multiple]="true"
                formControlName="offenceCommitted"
                [searchable]="true"
                [clearable]="true"
                [placeholder]="victims.at(i).get('offenceCommitted')?.value?.length ? '' : 'Select offences'"
                (change)="onOffenceCommittedChange(i)"
                [id]="'victimOffence' + i"
                required
              >
                <!-- Custom selected label -->
                <ng-template ng-label-tmp let-item="item" let-clear="clear">
                  <span>
                    {{ item.offence_act_name }}
                    <span *ngIf="!isActExcluded(item.offence_act_name)"> - {{ item.offence_name }}</span>
                  </span>
                  <span class="remove-icon" (click)="removeSelectedOffence(i, item.offence_name)">
                    &times;
                  </span>
                </ng-template>

                <!-- Custom dropdown option -->
                <ng-template ng-option-tmp let-item="item">
                  {{ item.offence_act_name }}
                  <span *ngIf="!isActExcluded(item.offence_act_name)"> - {{ item.offence_name }}</span>
                </ng-template>
              </ng-select>
                </div>




                <div class="col-md-12 mb-3"> 
                  <label class="form-label required">31. Sections of the SC/ST POA Act Invoked for the Offence</label><br>
                  <!-- <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Offence Acts</mat-label>
                    <mat-select formControlName="scstSections" multiple>
                      <mat-option *ngFor="let act of offenceActsOptions" [value]="act" >{{ act }}</mat-option>
                    </mat-select>
                  </mat-form-field> -->
                  <input type="text"  formControlName="scstSections" class="form-control" readonly />

                </div>
                <div class="col-md-12 mb-3">
                  <label for="sectionsIPC" class="form-label w-100">32. Section Invoked Under IPC/POCSO/etc.
                    <button type="button" class="btn btn-primary mt-2 float-right py-2" (click)="addSection(i)" style="float: right!important;">Add Section</button>

                  </label>
                  <div formArrayName="sectionDetails">
                    <div *ngFor="let section of getSectionDetails(i).controls; let j = index" [formGroupName]="j" class="section-entry mb-3">
                      <div class="row">
                        <div class="col-md-4 float-left mr-2">
                          <select id="sectionType{{ i }}-{{ j }}" class="form-control" formControlName="SectionType">
                            <option selected value="">Select</option>
                            <option value="IPC">IPC</option>
                            <option value="BNS">BNS</option>
                            <option value="BNSS">BNSS</option>
                            <option value="POCSO">POCSO</option>
                            <option value="Child Marriage Act">Child Marriage Act</option>
                            <option value="Women Harassment Act">Women Harassment Act</option>
                            <option value="PPDL">PPDL</option>
                            <option value="Others">Others</option>
                          </select>
                        </div>
          
                        <div class="col-md-5 float-left">
                          <input type="text" id="sectionName{{ i }}-{{ j }}" class="form-control" formControlName="Section" placeholder="Enter section name" />
                        </div>
          
                        <div class="col-md-2 text-center float-left">
                          <button *ngIf="j !== 0" type="button" class="btn btn-danger btn-sm" (click)="removeSection(i, j)">Delete</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- <label class="form-label">32. Section Invoked Under IPC/POCSO/etc. *</label>
                  <input type="text" formControlName="sectionsIPC" class="form-control" placeholder="Enter sections, separated by commas" />
                  <small class="form-text text-muted">Separate each section with a comma.</small> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-md-6 mb-3">
            <label for="isDeceased" class="form-label d-block required">33. Has the victim deceased due to the offence?</label>
            <select id="isDeceased" class="form-select" formControlName="isDeceased" (change)="onIsDeceasedChangeOutside()" required>
              <option value="" disabled>Select an option</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>
          <div class="col-md-6 mb-3" *ngIf="firForm.get('isDeceased')?.value === 'yes'">
            <label class="form-label required">34. Name(s) of the deceased person</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Select deceased person names</mat-label>
              <mat-select formControlName="deceasedPersonNames" multiple>
                <mat-option *ngFor="let name of victimNames" [value]="name">{{ name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="mt-4">
          <button type="button" class="btn btn-warning me-2" [disabled]="!SubmitButton" (click)="saveAsDraft()">Save as Draft</button>
          <button type="button" class="btn btn-secondary me-2" (click)="previousStep()">Previous</button>
          <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!isStepValid() || !SubmitButton">Next</button>
        </div>
      </div>
      <div *ngIf="mainStep === 1 && step === 4" class="form-step">
        <h3 class="mb-4">Step 4: Accused Information</h3>
      <div class="col-md-12">
        <div class="col-md-3 mb-3">
          <label for="numberOfAccused" class="form-label required">35. Number of Accused</label>
          <!-- <select id="numberOfAccused" class="form-select" formControlName="numberOfAccused" (change)="onNumberOfAccusedChange()" required>
            <option value="" disabled>Select the number of accused</option>
            <option *ngFor="let num of getAvailableNumbers()" [value]="num">{{ num }}</option>
          </select> -->
        <input type="number" class="form-control" formControlName="numberOfAccused" placeholder="Enter Accused Number" (change)="onNumberOfAccusedChange()"  required />
        </div>
        <div class="col-md-12 mb-3">
          <label for="accused_remarks" class="form-label">35a. Remarks</label>
          <textarea id="accused_remarks" class="form-control" formControlName="accused_remarks" rows="4" maxlength="3000" placeholder="Remarks"> </textarea>
          <small class="form-text text-muted">Maximum of 3000 Characters</small>
        </div>
      </div>
      <!-- <div class="row mb-3 align-items-center">
        <div class="col-md-3">
          <label for="numberOfAccused" class="form-label">35. Number of Accused *</label>
          <select id="numberOfAccused"
                  class="form-select"
                  formControlName="numberOfAccused"
                  (change)="onNumberOfAccusedChange()"
                  required>
            <option value="" disabled>Select the number of accused</option>
            <option *ngFor="let num of [1, 2, 3, 4, 5]" [value]="num">{{ num }}</option>
          </select>
        </div>
        <div class="col-md-9">
          <label for="accused_remarks" class="form-label">35a. Remarks</label>
          <textarea id="accused_remarks"
                    class="form-control"
                    formControlName="accused_remarks"
                    rows="4"
                    maxlength="3000"
                    placeholder="Remarks"></textarea>
          <small class="form-text text-muted">Maximum of 3000 Characters</small>
        </div>
      </div> -->

        <div formArrayName="accuseds">
          <div *ngFor="let accused of accuseds.controls; let i = index" [formGroupName]="i" class="accused-entry mb-4 card border-primary">
            <div style="align-items: center;" class="card-header bg-primary text-white">
              <h5 class="text-white mt-4">#{{ i + 1 }} Accused Details</h5>
                  <button  
                    style="height: 40px;"
                    type="button" 
                    class="btn btn-danger btn-sm" 
                    (click)="deleteAccused(i, accused.get('accusedId')?.value)"
                    [title]="'Delete Accused #' + (i + 1)">
                    <i class="fas fa-trash"></i> Delete
                  </button>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="accusedAge-{{i}}" class="form-label">36. Age of the Accused</label>
                  <input type="number" id="accusedAge-{{i}}" class="form-control" formControlName="age" placeholder="Enter age" (input)="onAccusedAgeChange(i)" required />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="accusedName-{{i}}" class="form-label required">37. Name of the Accused</label>
                  <input type="text" id="accusedName-{{i}}" class="form-control" formControlName="name" placeholder="Enter name" required />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="accusedGender{{ i }}" class="form-label required">38. Gender of the Accused</label>
                  <select [id]="'accusedGender' + i" class="form-select" formControlName="gender" required>
                    <option value="" disabled>Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="accusedAddress{{ i }}" class="form-label">39. Address of the Accused</label>
                  <input type="text" [id]="'accusedAddress' + i" class="form-control" formControlName="address" placeholder="Enter address" />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="accusedPincode{{ i }}" class="form-label">40. Pincode</label>
                  <input type="text" [id]="'accusedPincode' + i" class="form-control" formControlName="pincode" placeholder="Enter pincode" (keypress)="allowOnlyNumbers($event)" maxlength="6" pattern="^[0-9]{6}$" />
                  <!-- <div *ngIf="isPincodeInvalid(i)" class="text-danger mt-1">Please enter a valid 6-digit pincode.</div> -->
                </div>
                <div class="col-md-4 mb-3">
                  <label for="accusedCommunity{{ i }}" class="form-label required">41. Community of the Accused</label>
                  <!-- <select [id]="'accusedCommunity' + i" class="form-select" (change)="onAccusedCommunityChange($event, i)" formControlName="community" required>
                    <option value="" disabled>Select Community</option>
                    <option value="DNC">DNC</option>
                    <option value="BC">BC</option>
                    <option value="BCM">BCM</option>
                    <option value="MBC">MBC</option>
                  </select> -->
                  <ng-select  
                    [id]="'accusedCommunity' + i"
                    class="form-select"
                    [items]="accusedCommunitiesOptions"
                    bindLabel="community"
                    bindValue="community"
                    formControlName="community"
                    [searchable]="true"
                    [clearable]="false"
                    [placeholder]="accused.get('community')?.value ? '' : 'Select Community'"
                    (change)="onAccusedCommunityChange($event, i)"
                    required>
                  </ng-select>
                  <!-- <ng-select  
                  [id]="'accusedCommunity' + i"
                  class="form-select"
                  [items]="accusedCommunitiesOptions"
                  bindLabel="community"
                  bindValue="community"
                  formControlName="community"
                  [searchable]="true"
                  [clearable]="false"
                  [placeholder]="accused.get('community')?.value ? '' : 'Select Community'"
                  (change)="onAccusedCommunityChange($event, i)"
                  required>
                </ng-select> -->
                </div>
                <div class="col-md-4 mb-3">
                  <label for="accusedCaste{{ i }}" class="form-label required">42. Caste of the Accused</label>
                  <!-- <select [id]="'accusedCaste' + i" class="form-select" formControlName="caste" required>
                    <option value="" disabled>Select Caste</option>
                    <option *ngFor="let caste of accuseds.at(i).get('availableCastes')?.value" [value]="caste">
                      {{ caste }}
                    </option>
                  </select> -->
                  <!-- <ng-select  
                  [id]="'accusedCaste' + i"
                  class="form-select"
                  [items]="accuseds.at(i).get('availableCastes')?.value"
                  bindLabel="caste"
                  bindValue="caste"
                  formControlName="caste"
                  [searchable]="true"
                  [clearable]="false"
                  [placeholder]="accuseds.at(i).get('caste')?.value ? '' : 'Select Caste'"
                  required>
                </ng-select> -->
                <ng-select  *ngIf="showSubCaste"
                  [id]="'accusedCaste' + i"
                  class="form-select"
                  [items]="scstSectionsOptions"
                  bindLabel="caste"
                  bindValue="caste"
                  formControlName="caste"
                  [searchable]="true"
                  [clearable]="false"
                  [placeholder]="accuseds.at(i).get('caste')?.value ? '' : 'Select Caste'"
                  required>
                </ng-select>

                <input *ngIf="showSubCasteText" type="text" [id]="'accusedCaste' + i" class="form-control" formControlName="caste"  />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="accusedGuardian{{ i }}" class="form-label required">43. Name of Accused person’s Father/ Mother/ Spouse/ guardian</label>
                  <input type="text" [id]="'accusedGuardian' + i" class="form-control" formControlName="guardianName" placeholder="Enter father/spouse name" required />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="previousIncident{{ i }}" class="form-label required">44. Whether the accused person been involved in any previous incident/s against the same victim/ victim’s family?</label>
                  <select [id]="'previousIncident' + i" class="form-select" formControlName="previousIncident" (change)="onPreviousIncidentsChange(i)">
                    <option value="" disabled>Select</option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
    
                <div *ngIf="accused.get('previousIncident')?.value === 'true'" class="col-md-6 mb-3">
                  <label for="previousFIRNumber{{ i }}" class="form-label required">45. FIR number of previous cases</label>
                  <div class="input-group">
                    <!-- <select [id]="'previousFIRNumber' + i" class="form-select" formControlName="previousFIRNumber">
                      <option value="" disabled>Select FIR Number</option>
                      <option *ngFor="let num of firNumberOptions" [value]="num">{{ num }}</option>
                    </select> -->
                    <input type="text" [id]="'previousFIRNumber' + i" (keypress)="allowOnlyNumbers($event)" class="form-control" formControlName="previousFIRNumber" placeholder="FIR Number" required />
                    <span class="input-group-text">/</span>
                    <select [id]="'previousFIRNumberSuffix' + i" class="form-select" formControlName="previousFIRNumberSuffix">
                      <option value="" disabled>Select Year</option>
                      <option *ngFor="let year of yearOptions" [value]="year">{{ year }}</option>
                    </select>
                  </div>
                  <small *ngIf="!isFirValid('previousFIRNumber'+ i, 'previousFIRNumberSuffix'+ i)"  class="text-danger d-block mt-1">Please follow the format "12/2024".</small>
                </div>
                <div *ngIf="accused.get('previousIncident')?.value === 'true'" class="col-md-12 mb-3">
                    <label for="previous_incident_remarks{{ i }}" class="form-label">45a. Remarks</label>
                    <textarea [id]="'previous_incident_remarks' + i" class="form-control" formControlName="previous_incident_remarks" rows="4" maxlength="3000" placeholder="Remarks" ></textarea>
                    <small class="form-text text-muted">Maximum of 3000 Characters</small>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="scstOffence{{ i }}" class="form-label required">46. Whether the accused person has committed any offence against members of the SC/ ST community?</label>
                  <select [id]="'scstOffence' + i" class="form-select" formControlName="scstOffence" (change)="onScstOffencesChange(i)">
                    <option value="" disabled>Select</option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3" *ngIf="accused.get('scstOffence')?.value === 'true'">
                  <label for="scstFIRNumber{{ i }}" class="form-label required">47. FIR number of previous</label>
                  <div class="input-group">
                    <!-- <select [id]="'scstFIRNumber' + i" class="form-select" formControlName="scstFIRNumber" required>
                      <option value="" disabled>Select FIR Number</option>
                      <option *ngFor="let num of firNumberOptions" [value]="num">{{ num }}</option>
                    </select> -->
                     <input type="text" [id]="'scstFIRNumber' + i" class="form-control" (keypress)="allowOnlyNumbers($event)" formControlName="scstFIRNumber" placeholder="FIR Number" required />
                    <span class="input-group-text">/</span>
                    <select [id]="'scstFIRNumberSuffix' + i" class="form-select" formControlName="scstFIRNumberSuffix" required>
                      <option value="" disabled>Select Year</option>
                      <option *ngFor="let year of yearOptions" [value]="year">{{ year }}</option>
                    </select>
                  </div>
                  <small *ngIf="!isFirValid('scstFIRNumber' + i, 'scstFIRNumberSuffix' + i)" class="text-danger d-block mt-1">Please follow the format "12/2024".</small>
                </div>
                <div *ngIf="accused.get('scstOffence')?.value === 'true'" class="col-md-12 mb-3">
                  <label for="previous_offence_remarks{{ i }}" class="form-label">47a. Remarks</label>
                  <textarea [id]="'previous_offence_remarks' + i" class="form-control" formControlName="previous_offence_remarks" rows="4" maxlength="3000" placeholder="Remarks" ></textarea>
                  <small class="form-text text-muted">Maximum of 3000 Characters</small>
                </div>
                <!-- <div class="col-md-6 mb-3">
                  <label for="antecedents{{ i }}" class="form-label">48. Antecedents of the Accused (History sheeter / Goondas / Bind over, etc.) *</label>
                  <input type="text" [id]="'antecedents' + i" class="form-control" formControlName="antecedents" placeholder="Enter antecedents" required />
                </div> -->
                <div class="col-md-6">
                  <label for="antecedentsOption{{ i }}" class="form-label required">48a. Antecedents</label>
                  <select class="form-control" formControlName="antecedentsOption">
                    <option value="">Select</option>
                    <option value="Yes">Yes</option>
                    <option selected value="NA">NA</option>
                  </select>
                 </div>

                <div class="col-md-6 mb-3" *ngIf="accused.get('antecedentsOption')?.value === 'Yes'">
                    <label for="antecedents{{ i }}" class="form-label required">48b. Antecedents of the Accused (History sheeter / Goondas / Bind over, etc.)</label>
                    <input type="text" [id]="'antecedents' + i" class="form-control" formControlName="antecedents" placeholder="Enter antecedents"  (input)="checkInput(i, 'antecedents')"/>
                </div>
                <!-- <div class="col-md-6 mb-3">
                  <label for="landOIssues{{ i }}" class="form-label">49. L&O Issues (Pickets, Bandobust, etc) *</label>
                  <input type="text" [id]="'landOIssues' + i" class="form-control" formControlName="landOIssues" placeholder="Enter L&O issues" required />
                </div> -->
                <div class="col-md-6">
                  <label for="loissue{{ i }}" class="form-label required">49a. L & O Issues</label>
                  <select class="form-control" formControlName="landOIssueOption">
                    <option value="">Select</option>
                    <option value="Yes">Yes</option>
                    <option selected value="NA">NA</option>
                  </select>
                 </div>
                <div class="col-md-6 mb-3" *ngIf="accused.get('landOIssueOption')?.value === 'Yes'">
                  <label for="landOIssues{{ i }}" class="form-label required">49b. L&O Issues (Pickets, Bandobust, etc)</label>
                  <input type="text" [id]="'landOIssues' + i" class="form-control" formControlName="landOIssues" placeholder="Enter L&O issues" (input)="checkInput(i, 'landOIssues')"/>
                </div>
                <!-- <div class="col-md-12 mb-3">
                  <label for="gistOfCurrentCase{{ i }}" class="form-label">50. Gist of the Current Case *</label>
                  <textarea [id]="'gistOfCurrentCase' + i" class="form-control" formControlName="gistOfCurrentCase" rows="4" maxlength="3000" placeholder="Enter gist of the current case" required></textarea>
                  <small class="form-text text-muted">Maximum of 3000 Characters</small>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">51. Upload FIR Copy *</label>
                  <input type="file" [id]="'uploadFIRCopy' + i" class="form-control"
                        required (change)="onFIRFileUpload($event, i)" multiple *ngIf="!uploadedFIRFileNames[i]" />
                  <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="uploadedFIRFileNames[i]">
                    <div class="d-flex justify-content-start align-items-center">
                      {{ uploadedFIRFileNames[i] }}
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <button class="btn btn-primary btn-sm me-2" (click)="viewFIRCopy(i)">View</button>
                      <button class="btn btn-danger btn-sm" (click)="removeFIRCopy(i)">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                </div> -->

                
                <!-- <div *ngIf="uploadedFiles[i]; else existingFile">
                  <img [src]="fileUrls[i]" class="img-thumbnail" alt="FIR Copy" style="max-width: 150px; margin-bottom: 10px;">
                  <button class="btn btn-danger btn-sm mt-2" (click)="onDeleteFile(i)">Delete</button>
                </div> -->
                
                <!-- <ng-template #existingFile>
                  <div *ngIf="accused.get('uploadFIRCopy')?.value">
                    <img [src]="image_access + accused.get('uploadFIRCopy')?.value" 
                         class="img-thumbnail" alt="FIR Copy" style="max-width: 150px; margin-bottom: 10px;">
                  </div>
                </ng-template> -->
                
              </div>
            </div>
          </div>
        </div>

      <div class="col-md-12 mb-3">
        <label for="gistOfCurrentCase" class="form-label required">50. Gist of the Current Case</label>
        <textarea id="gistOfCurrentCase" class="form-control" formControlName="gistOfCurrentCase" rows="4" maxlength="3000" placeholder="Enter gist of the current case" required></textarea>
        <small class="form-text text-muted">Maximum of 3000 Characters</small>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label required">51. Upload FIR Copy</label><span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
        <input type="file" id="uploadFIRCopy" class="form-control"
              required (change)="onFIRFileUpload($event)" multiple *ngIf="!uploadedFIRFileNames" />
        <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="uploadedFIRFileNames">
          <div class="d-flex justify-content-start align-items-center">
            {{ uploadedFIRFileNames }}
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <button class="btn btn-primary btn-sm me-2" (click)="viewFIRCopy()">View</button>
            <button class="btn btn-danger btn-sm" (click)="removeFIRCopy()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>


        <div class="mt-4">
          <button type="button" class="btn btn-warning me-2" [disabled]="!SubmitButton" (click)="saveAsDraft()">Save as Draft</button>
          <button type="button" class="btn btn-secondary me-2" (click)="previousStep()">Previous</button>
          <!-- <button type="button" class="btn btn-primary" (click)="saveStepFourAsDraft()" [disabled]="!isStepValid()">Next</button> -->
          <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!isStepValid() || !SubmitButton">Submit</button>
        </div>
      </div>
      <div *ngIf="mainStep === 1 && step === 5" class="form-step">

<!-- <div formArrayName="victimsRelief">
  <div *ngFor="let victimRelief of victimsRelief.controls; let i = index" [formGroupName]="i">
    <input formControlName="victimName" placeholder="Victim Name" />
    <input formControlName="reliefAmountScst" placeholder="SC/ST Relief Amount" />
    <input formControlName="communityCertificate" placeholder="Community Certificate" />
  </div>
</div> -->
<form [formGroup]="firForm">
<div formArrayName="victimsRelief">

        <div   *ngFor="let victimRelief of victimsRelief.controls; let i = index" [formGroupName]="i" class="card border-primary mb-4">
          <div class="card-body">
            <div class="mb-4 col-md-4">
              <label for="communityCertificate" class="form-label required">52. Has the Community Certificate of the Victim(s) been Verified and Obtained?</label>
              <select id="communityCertificate" formControlName="communityCertificate" class="form-select" required>
                <option value="" disabled selected>Select One</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="mb-4 col-lg-4">
              <label class="form-label required">53. Name of the Victim</label>
              <input id="victimName" type="text" class="form-control mb-3" formControlName="victimName" placeholder="Name of the Victim" readonly />
            </div>
            <div class="row mb-3">
              <div class="col-8">
                <label for="reliefAmountScst" class="form-label required">54. Eligible relief amount for the victim as per SC/ST Act</label>
              </div>
              <div class="col-4">
                <input id="reliefAmountScst" type="text" class="form-control text-end" formControlName="reliefAmountScst" (keypress)="allowOnlyNumbers($event)" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-8">
                <label class="form-label required">55. Eligible relief amount for the victim (ex-gratia) by Govt. of Tamil Nadu</label>
              </div>
              <div class="col-4">
                <input type="text" class="form-control text-end" formControlName="reliefAmountExGratia" placeholder="0" (keypress)="allowOnlyNumbers($event)" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-8">
                <label class="form-label required">56. Eligible amount for the 1st Stage of Relief</label>
              </div>
              <div class="col-4">
                <input type="text" class="form-control text-end" formControlName="reliefAmountFirstStage" placeholder="0" (keypress)="allowOnlyNumbers($event)"  />
              </div>
            </div>
            <div class="mb-4" *ngIf="victimRelief.get('relief_applicable')?.value == 1 || victimRelief.get('relief_applicable2')?.value == 1">
              <label class="form-label d-block mb-2 required">
                57. Eligible additional relief for the legal heir of the person died (Victim {{ i + 1 }})
              </label>
              
              <div class="d-flex flex-wrap gap-3">
                <div class="form-check" *ngFor="let option of additionalReliefOptions; let j = index">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    [id]="'additionalRelief-' + option.value + '-' + j + '-' + i"
                    [value]="option.value"
                    (change)="onAdditionalReliefChange($event, option.value, i)"
                    [checked]="victimRelief.get('additionalRelief')?.value.includes(option.value)"
                  />
                  <label
                    class="form-check-label ms-2"
                    [for]="'additionalRelief-' + option.value + '-' + j + '-' + i"
                    [ngClass]="{ 'selected-text': victimRelief.get('additionalRelief')?.value.includes(option.value) }"
                  >
                    {{ option.label }}
                  </label>
                </div>
              </div>
            </div>
            
          </div>
        </div>
        <div class="row mb-4">
          <div class="col-8">
            <label class="form-label required">58. Total Amount for 1st Stage of Compensation (Total across all victims)</label>
          </div>
          <div class="col-4">
            <input 
            type="text" 
            class="form-control text-end" 
            [formControl]="totalCompensationControl" />
          
          
          </div>
          
        </div>
      </div>
      
      
    </form>
      <div class="row mb-4">
          <div class="mb-4 col-6">
            <label class="form-label required">59. Proceedings File No.</label>
            <input type="text" class="form-control" formControlName="proceedingsFileNo" placeholder="Enter File No." />
          </div>
          <div class="mb-4 col-6">
            <label class="form-label required">60. Proceedings Date</label>
            <input type="date" class="form-control" formControlName="proceedingsDate" />
          </div>
        </div>
        <!-- <div class="mb-4">
          <label class="form-label">61. Upload Commissionerate / S.P. Office Proceedings *</label>
          <input type="file" class="form-control" id="proceedingsFile" />
        </div> -->
        <!-- <div class="mb-4">
          <label class="form-label">61. Upload Commissionerate / S.P. Office Proceedings *</label>
          <input
            type="file"
            class="form-control"
            (change)="onProceedingsFileChange($event)"
          />
        </div> -->

        <div class="col-md-6 mb-3">
          <label class="form-label required">61. Upload Commissionerate / S.P. Office Proceedings</label><span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
          <input type="file" class="form-control" 
                 (change)="onProceedingsFileUpload($event)" required *ngIf="!proceedingFileName"/>
          <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="proceedingFileName">
            <div class="d-flex justify-content-start align-items-center">
              {{proceedingFileName}}
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <button class="btn btn-primary btn-sm me-2" (click)="viewProceedingsCopy()">View</button>
              <button class="btn btn-danger btn-sm" (click)="removeProceedingsCopy()"><i class="fas fa-times"></i></button>
            </div>
          </div>
        
         
          <!-- <div *ngIf="fileUrls_proceding[i]; else existingFile_proceding">
            <img [src]="fileUrls_proceding[i]" class="img-thumbnail" 
                 alt="Proceedings File" style="max-width: 150px; margin-bottom: 10px;">
          </div>
        
     
          <ng-template #existingFile_proceding>
            <div *ngIf="firForm.get('proceedingsFile')?.value">
              <img [src]="apiUrl1 + firForm.get('proceedingsFile')?.value" 
                   class="img-thumbnail" alt="Proceedings File" 
                   style="max-width: 150px; margin-bottom: 10px;">
            </div>
          </ng-template> -->
        </div>
        
        
        <div class="mb-4">
          <label class="form-label">62. Upload Key Attachments</label><span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
        
          <div class="mb-3" *ngFor="let attachment of attachmentss_1; let j = index">
            <div class="d-flex align-items-center">
               <input type="file" class="form-control w-100 mb-2"
                   (change)="onFileChangee($event, j)"
                   style="max-width: 400px;" *ngIf="!attachment.path"/>
                   <button class="btn btn-danger btn-sm" (click)="removeAttachment_1(j)"
                    title="Remove Attachment" *ngIf="!attachment.path"><i class="fas fa-times"></i></button>
            </div>
            <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="attachment.path">
              <div class="d-flex justify-content-start align-items-center">
                {{attachment.path}}
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <button class="btn btn-primary btn-sm me-2" (click)="view62(attachment.path)">View</button>
                <button class="btn btn-danger btn-sm" (click)="removeAttachment_1(j)"
                    title="Remove Attachment"><i class="fas fa-times"></i></button>
              </div>
            </div>
        
            <!-- <div *ngIf="attachment.path">
              <img [src]="attachment.path" 
                   class="img-thumbnail" alt="Preview" 
                   style="max-width: 150px;">
            </div> -->
        
            <!-- <button type="button" class="btn btn-danger btn-sm mt-1"
                    (click)="removeAttachment_1(j)"
                    title="Remove Attachment">
              <i class="bi bi-trash"></i> Remove
            </button> -->
          </div>
        
          <button type="button" class="btn btn-primary btn-sm mt-3" (click)="addAttachment_1()">
            Add Attachment
          </button>
        </div>

        
      
        
        
        
        
        
<!-- 
        <div class="mb-4">
          <label class="form-label">93. Upload Other Attachment (If any)</label>
          <div class="file-drop-container">
            <ngx-dropzone (drop)="onDrop1($event)" (fileOver)="onFileOver1($event)" (click)="triggerFileInputClick1()" [accept]="'image/*'" [multiple]="true" class="dropzone">
              <input #fileInput type="file" (change)="onChange1($event)" multiple accept="image/*" class="file-input-hidden" />
              <div class="dropzone-content" [ngClass]="{'file-over': isFileOver}">
                <p *ngIf="!isFileOver">Drag and drop your files here or click to select</p>
                <p *ngIf="isFileOver">Release to drop the files!</p>
              </div>
            </ngx-dropzone>
            <div class="file-previews">
              <div *ngFor="let file of allFiles; let i = index" class="file-preview">
                <img [src]="file.file_path" alt="Uploaded File preview" class="file-preview-img" />
                <p></p>
                <button class="remove-file" (click)="removeFile2(i)">Remove</button>
              </div>
              <div *ngFor="let file of files1; let i = index" class="file-preview">
                <img *ngIf="file.previewUrl" [src]="file.previewUrl" alt="file preview" class="file-preview-img" />
                <p>{{ file.name }}</p>
                <button class="remove-file" (click)="removeFile1(i)">Remove</button>
              </div>
            </div>
          </div>
        </div> -->
        <div class="mt-4">
          <button type="button" class="btn btn-warning me-2" [disabled]="!SubmitButton" (click)="saveAsDraft()">Save as Draft</button>
          <button type="button" class="btn btn-secondary me-2" (click)="previousStep()">Previous</button>
          <button *ngIf="step === 5" type="submit" class="btn btn-primary" [disabled]="!firstageValid() || !SubmitButton" (click)="submitStepFive()">Submit</button>
        </div>
      </div>





      <div *ngIf="mainStep === 2 && step === 1" class="form-step">
        <div class="card border-primary mb-4">
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-md-4">
                <label for="chargeSheetFiled" class="form-label required">63. Charge Sheet filed with the Court?</label>
                <select id="chargeSheetFiled" class="form-select" formControlName="chargeSheetFiled" required>
                  <option value="" disabled>Select One</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="courtDivision" class="form-label required">64. Court Division</label>
                <select id="courtDivision" class="form-select" formControlName="courtDivision" required (change)="onCourtDivisionChange($event)">
                  <option value="" disabled>Select Court Division</option>
                  <option *ngFor="let division of courtDivisions" [value]="division">{{ division }}</option>
                </select>
                <!-- <ng-select
                  id="courtDistrict"
                  class="form-select"
                  [items]="courtDivisions"
                  bindLabel="label" 
                  bindValue="value" 
                  formControlName="courtDistrict"
                  [searchable]="true"
                  [clearable]="false"
                  [placeholder]="firForm.get('courtDistrict')?.value ? '' : 'Select Court Division'"
                  (change)="onCourtDivisionChange($event)"
                  required>
              </ng-select> -->
              </div>
              <div class="col-md-4">
                <label for="courtName" class="form-label required">65. Court Range</label>
                <select id="courtName" class="form-select" formControlName="courtName" required>
                  <option value="" disabled>Select Court Range</option>
                  <option *ngFor="let range of courtRanges" [value]="range">{{ range }}</option>
                </select>
                <!-- <ng-select
                id="courtName"
                class="form-select"
                [items]="courtRanges"
                bindLabel="label"
                bindValue="value"
                formControlName="courtName"
                [searchable]="true"
                [clearable]="false"
                [placeholder]="firForm.get('courtName')?.value ? '' : 'Select Court Range'"
                required>
              </ng-select> -->
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-4 mb-3">
                <label for="caseType" class="form-label required">66. Select Nature of Final Report</label>
                <select id="caseType" class="form-select" formControlName="caseType" required>
                  <option value="" disabled>Select Case Type</option>
                  <option value="chargeSheet">Charge Sheet</option>
                  <option value="referredChargeSheet">Referred Charge Sheet (RCS)</option>
                  <option value="sectionDeleted">Section Deleted</option>
                  <option value="firQuashed">FIR Quashed</option>
                </select>
              </div>
              <!-- <div *ngIf="firForm.get('caseType')?.value === 'chargeSheet'" class="col-lg-6">
                <label for="caseNumber" class="form-label">67. Case Number Report (CNR) / Special SC Number *</label>
                <input type="text" id="caseNumber" class="form-control" formControlName="caseNumber" placeholder="Enter Case Number" required/>
              </div> -->
              <div class="col-lg-6" *ngIf="firForm.get('caseType')?.value === 'chargeSheet'">
                <label for="caseNumber" class="form-label required">67a. CNR Number</label>
                <input
                  type="text"
                  id="caseNumber"
                  class="form-control"
                  formControlName="caseNumber"
                  placeholder="Enter Case Number"
                  required
                />
                </div>
                <div class="col-lg-6" *ngIf="firForm.get('caseType')?.value === 'chargeSheet'">
                <label for="ChargeSheet_CRL_number" class="form-label required">67b. SC/ Special SC Number</label>
                <input
                  type="text"
                  id="ChargeSheet_CRL_number"
                  class="form-control"
                  formControlName="ChargeSheet_CRL_number"
                  placeholder="SC/ Special SC Number"
                  required
                />
                </div>
                <div class="col-lg-4" *ngIf="firForm.get('caseType')?.value === 'chargeSheet'">
                  <label for="chargeSheetDate" class="form-label">67c. Date of Chargesheet</label>
                  <input
                    type="date"
                    id="chargeSheetDate"
                    class="form-control"
                    formControlName="chargeSheetDate"
                  />
                </div>


              <div *ngIf="firForm.get('caseType')?.value === 'firQuashed'" class="col-md-12">
              <div class="row">
                 
              <div class="row mb-4">
              <div class="mb-4 col-6">
                <label class="form-label required">Quash Petition No.</label>
                <input type="text" class="form-control" formControlName="quash_petition_no" placeholder="Quash Petition No." required />
              </div>
              <div class="mb-4 col-6">
                <label class="form-label required">Petition Date</label>
                <input type="date" class="form-control" formControlName="petition_date" [max]="today" required/>
              </div>
            </div>

              <div class="mb-4">
              <label class="form-label">Upload Court Order</label> <span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
         
            <input type="file" id="upload_court_order" class="form-control" required 
            (change)="upload_court_order_FileUpload($event)" multiple *ngIf="!upload_court_order_path"/>
            <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="upload_court_order_path">
            <div class="d-flex justify-content-start align-items-center">
              {{upload_court_order_path}}
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <button class="btn btn-primary btn-sm me-2" (click)="view_upload_court_order()">View</button>
              <button class="btn btn-danger btn-sm" (click)="remove_upload_court_order()"><i class="fas fa-times"></i></button>
            </div>
          </div>
          </div>

        </div>
        </div>



        <div *ngIf="firForm.get('caseType')?.value === 'sectionDeleted'" class="col-md-12">
            <div class="row">
                 
              <div class="row mb-4">
              <div class="mb-4 col-6">
                <label class="form-label required">Proceedings File No.</label>
                <input type="text" class="form-control" formControlName="proceedingsFileNo_1" placeholder="Enter File No." required />
              </div>
              <div class="mb-4 col-6">
                <label class="form-label required">Proceedings Date</label>
                <input type="date" class="form-control" formControlName="proceedingsDate_1" [max]="today" required/>
              </div>
            </div>

              <div class="mb-4">
              <label class="form-label required">Upload Commissionerate / S.P. Office Proceedings</label> <span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
         
            <input type="file" [id]="'uploadProceedings_1' + i" class="form-control" required 
            (change)="onProceedingsFileUpload2($event)" multiple *ngIf="!proceedingFileName2"/>
            <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="proceedingFileName2">
            <div class="d-flex justify-content-start align-items-center">
              {{proceedingFileName2}}
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <button class="btn btn-primary btn-sm me-2" (click)="viewProceedingsCopy2()">View</button>
              <button class="btn btn-danger btn-sm" (click)="removeProceedingsCopy2()"><i class="fas fa-times"></i></button>
            </div>
          </div>
          </div>

        </div>
        </div>


              <div *ngIf="firForm.get('caseType')?.value === 'referredChargeSheet'" class="col-md-12">
                <div class="row">
                  <div class="col-lg-6">
                    <label for="rcsFileNumber" class="form-label required">68. Referred Charge Sheet (RCS) file number</label>
                    <input type="text" id="rcsFileNumber" class="form-control" formControlName="rcsFileNumber" required placeholder="Enter RCS File Number"/>
                  </div>
                  <div class="col-lg-6">
                    <label for="rcsFilingDate" class="form-label required">69. Referred Charge Sheet (RCS) filing date</label>
                    <input type="date" id="rcsFilingDate" class="form-control" formControlName="rcsFilingDate" required placeholder="Enter Case Number"/>
                  </div>

                  <!-- <div class="col-lg-6">
                    <label for="mfCopy" class="form-label">70. Upload MF copy</label>
                    <input type="file" id="mfCopy" class="form-control" formControlName="mfCopy" required/>
                  </div> -->


                    <div class="mb-4">
                        <label class="form-label required">70. Upload MF copy</label><span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
   
                      <input type="file" id = "mfCopy" class="form-control" required 
                      (change)="MFcopyFileUpload($event)" *ngIf="!mfCopyPath"/>
                      <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="mfCopyPath">
                      <div class="d-flex justify-content-start align-items-center">
                        {{mfCopyPath}}
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-primary btn-sm me-2" (click)="viewMFcopyFile()">View</button>
                        <button class="btn btn-danger btn-sm" (click)="removeMFcopyFile()"><i class="fas fa-times"></i></button>
                      </div>
                    </div>
                    </div>
                    

                </div>
              </div>

            </div>
          </div>
        </div>
        <div class="" *ngIf="firForm.get('caseType')?.value == 'chargeSheet'">
          <div formArrayName="victimsRelief">
            <div *ngFor="let victimRelief of victimsRelief.controls; let i = index" [formGroupName]="i" class="card border-primary mb-4">
              <div class="card-body">
                <div class="mb-4 col-lg-4">
                  <label class="form-label required">71. Name of the Victim</label>
                  <input type="text" class="form-control mb-3" [value]="victimNames?.[i] || ''" placeholder="Name of the Victim" disabled />
                </div>
                <div class="row mb-3">
                  <div class="col-8">
                    <label class="form-label required">72. Eligible second stage relief amount for the victim as per the SC and ST Prevention of Atrocities Act (amended upto 2016)</label>
                  </div>
                  <div class="col-4">
                    <input type="text" class="form-control text-end" formControlName="reliefAmountScst_1" (keypress)="allowOnlyNumbers($event)" />
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-8">
                    <label class="form-label required">73. Eligible second stage relief amount for the victim (ex-gratia) by the Govt. of Tamil Nadu</label>
                  </div>
                  <div class="col-4">
                    <input type="text" class="form-control text-end" formControlName="reliefAmountExGratia_1" (keypress)="allowOnlyNumbers($event)" />
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-8">
                    <label class="form-label required">74. Total eligible amount for the victim for the second stage of relief</label>
                  </div>
                  <div class="col-4">
                    <input type="text" class="form-control text-end" formControlName="reliefAmountSecondStage" (keypress)="allowOnlyNumbers($event)"  />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card border-primary mb-4" *ngIf="firForm.get('caseType')?.value == 'chargeSheet'">
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-8">
                <label class="form-label required">75. Total amount for second stage of compensation (total of relief across all victims)</label>
              </div>
              <div class="col-4">
                <input type="text" class="form-control text-end" formControlName="totalCompensation_1" />
              </div>
            </div>
            <div class="row mb-4">
              <div class="mb-4 col-6">
                <label class="form-label required">76. Proceedings File No.</label>
                <input type="text" class="form-control" formControlName="proceedingsFileNo_1" placeholder="Enter File No." required />
              </div>
              <div class="mb-4 col-6">
                <label class="form-label required">77. Proceedings Date</label>
                <input type="date" class="form-control" formControlName="proceedingsDate_1" [max]="today" required/>
              </div>
            </div>
            <!-- <div class="mb-4">
              <label class="form-label">71. Upload Commissionerate / S.P. Office Proceedings *</label>
              <input type="file" class="form-control" id="uploadProceedings_1" />
              <div *ngIf="firForm.get('uploadProceedings_1')?.value"> 
                <img [src]="firForm.get('uploadProceedings_1')?.value" alt="Proceedings File" class="file-preview-img" />
              </div>
            </div> -->

            <div class="mb-4">
              <label class="form-label required">78. Upload Commissionerate / S.P. Office Proceedings</label><span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
              <!-- <input type="file" class="form-control" formControlName="uploadProceedings_1" required/> -->
              <!-- <input
              type="file"
              class="form-control"
              (change)="onProceedingsFileChange_1($event)" required
            /> -->


            <input type="file" [id]="'uploadProceedings_1' + i" class="form-control" required 
            (change)="onProceedingsFileUpload2($event)" multiple *ngIf="!proceedingFileName2"/>
            <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="proceedingFileName2">
            <div class="d-flex justify-content-start align-items-center">
              {{proceedingFileName2}}
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <button class="btn btn-primary btn-sm me-2" (click)="viewProceedingsCopy2()">View</button>
              <button class="btn btn-danger btn-sm" (click)="removeProceedingsCopy2()"><i class="fas fa-times"></i></button>
            </div>
          </div>
          </div>


          <!-- <div *ngIf="fileUrls_proceding1[i] ; else existingFile1">
            <img [src]="fileUrls_proceding1[i]" class="img-thumbnail" 
                 alt="Proceedings File1" style="max-width: 150px; margin-bottom: 10px;">
          </div>

          <ng-template #existingFile1>
            <div *ngIf="firForm.get('uploadProceedings_1')?.value">
              <img [src]="image_access + firForm.get('uploadProceedings_1')?.value" 
                   class="img-thumbnail" alt="FIR Copy" style="max-width: 150px; margin-bottom: 10px;">
            </div>
          </ng-template> -->


            <!-- <div class="mb-4">
              <label class="form-label">79. Upload Other Attachment (If any)</label>
              <div class="file-drop-container">
                <ngx-dropzone (drop)="onDrop2($event)" (fileOver)="onFileOver2($event)" (click)="triggerFileInputClick2()" [accept]="'image/*'" [multiple]="true" class="dropzone">
                  <input #fileInput type="file" (change)="onChange2($event)" multiple accept="image/*" class="file-input-hidden" />
                  <div class="dropzone-content" [ngClass]="{'file-over': isFileOver}">
                    <p *ngIf="!isFileOver2">Drag and drop your files here or click to select</p>
                    <p *ngIf="isFileOver2">Release to drop the files!</p>
                  </div>
                </ngx-dropzone>
                <div class="file-previews">
                  <div *ngFor="let file of allFiles1; let i = index" class="file-preview">
                    <img [src]="file.file_path" alt="Uploaded File preview" class="file-preview-img" />
                    <p></p>
                    <button class="btn btn-primary">View</button>
                    <button class="remove-file" (click)="removeFile4(i)">Remove</button>
                  </div> 
                  <div *ngFor="let file of files2; let i = index" class="file-preview">
                    <img *ngIf="file.previewUrl" [src]="file.previewUrl" alt="file preview" class="file-preview-img" />
                    <p>{{ file.name }}</p>
                    <button class="remove-file" (click)="removeFile3(i)">Remove</button>
                  </div>
                </div>
              </div>
            </div> -->

                <div class="mb-4" formArrayName="attachments_1">
                  <label class="form-label">79. Upload Other Attachments (If any)</label> <span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>

                  <div
                    class="input-group mb-2"
                    *ngFor="let attachment of attachments_1.controls; let j = index"
                    [formGroupName]="j"
                  >
                    <!-- File Input (only if no fileName yet) -->
                    <input
                      type="file"
                      class="form-control"
                      (change)="onFileSelect_1New($event, j, 'file', 'fileName')"
                      *ngIf="!attachment.get('fileName')?.value"
                    />
                    <button
                      type="button"
                      class="btn btn-danger btn-sm"
                      (click)="removeAttachment_1_new(j)"
                      title="Remove Attachment"
                      *ngIf="!attachment.get('fileName')?.value"
                    >
                      <i class="fas fa-times"></i>
                    </button>

                    <!-- Display Uploaded File Name & Actions -->
                    <div
                      class="d-flex justify-content-between align-items-center uploaded mt-2"
                      *ngIf="attachment.get('fileName')?.value"
                    >
                      <div>{{ attachment.get('fileName')?.value }}</div>
                      <div class="d-flex">
                        <button
                          class="btn btn-primary btn-sm me-2"
                          (click)="viewAttachment_1(j)"
                        >
                          View
                        </button>
                        <button
                          type="button"
                          class="btn btn-danger btn-sm"
                          (click)="removeAttachment_1_new(j)"
                          title="Remove Attachment"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Add Attachment Button -->
                  <button
                    type="button"
                    class="btn btn-primary btn-sm mt-3"
                    (click)="addAttachment_1_new()"
                  >
                    Add Attachment
                  </button>
                </div>



          </div>
        </div>
        <div class="mt-4">
          <button type="button" class="btn btn-warning me-2" [disabled]="!SubmitButton" (click)="saveAsDraft_6()">Save as Draft</button>
          <!-- <button type="button" class="btn btn-secondary me-2" (click)="previousStep()">Previous</button> -->
          <button type="button" class="btn btn-secondary me-2" (click)="previousMainStep()">Previous</button>
          <button type="button" class="btn btn-primary" (click)="submitStepSix();saveAsDraft_6()" [disabled]="!isStep6Valid() || !SubmitButton">Submit</button>
        </div>
      </div>
     
      <div *ngIf="mainStep === 3 && step === 1" class="form-step">

        <!-- Case Trial and Court Details -->
        <div class="card border-primary mb-4">
            <div class="card-body">
              <h4 class="mb-4">73. Case Trial and Court Details</h4>
                <div class="row">
                    <!-- Item 74 -->
                  
                    <!-- Item 75 -->
                    <!-- <div class="col-md-6 mb-3">
                      <label class="form-label">80. District in which court is present *</label> -->
                      <!-- <select class="form-select" formControlName="trialCourtDistrict" required>
                        <option value="" disabled selected>Select District</option>
                        <option *ngFor="let district of courtDistricts" [value]="district">{{ district }}</option>
                      </select> -->
                      <!-- <ng-select
                        class="form-select"
                        [items]="courtDistricts"
                        bindLabel="district"
                        bindValue="district"
                        formControlName="courtDistrict"
                        [searchable]="true"
                        [clearable]="false"
                        [placeholder]="firForm.get('courtDistrict')?.value ? '' : 'Select District'"
                        required>
                      </ng-select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">81. Name of the Designated / Special court *</label>
                      <input type="text" class="form-control" formControlName="Court_name1" placeholder="Enter Name" required />
                  </div> -->


                  <div class="col-md-6 mb-3">
                    <label class="form-label required">80. Division in which court is present</label>
                    <ng-select class="form-select" [items]="courtDivisions" bindLabel="district" bindValue="district"
                      formControlName="courtDistrict" [searchable]="true" [clearable]="false"
                      [placeholder]="firForm.get('courtDistrict')?.value ? '' : 'Select District'" (change)="onCourtDivisionChange2($event)" required>
                    </ng-select>
                  </div>
            
                  <div class="col-md-6 mb-3">
                    <label class="form-label required">81. Name of the Designated / Special court</label>
                    <!-- <input type="text" class="form-control" formControlName="Court_name1" placeholder="Enter Name" required /> -->
                    <ng-select class="form-select" [items]="courtRanges5" bindLabel="label" bindValue="value"
                      formControlName="Court_name1" [searchable]="true" [clearable]="false"
                      [placeholder]="firForm.get('Court_name1')?.value ? '' : 'Select Court Range'" required>
                    </ng-select>
                  </div>

                    <!-- Item 76 -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">82. CNR Numbers</label>
                        <input type="text" class="form-control" formControlName="trialCaseNumber" placeholder="Enter CNR Numbers" required />
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label required">82.A SC/Special SC Number</label>
                        <input type="text" class="form-control" formControlName="CRL_number" placeholder="Enter SC/Special SC Number" required />
                    </div>

<!-- newly addaed item -->

<div class="col-md-6 mb-3">
<label class="form-label required">82. B. Case is handled by</label>
<select class="form-select" formControlName="CaseHandledBy"(change)="onCaseHandledByChange($event)" required>
<option value="" disabled selected>Select </option>
<option *ngFor="let data of CaseHandledBy" [value]="data">{{ data }}</option>
</select>
</div>


<div *ngIf="show94BAnd94C" class="col-md-6 mb-3">
<label class="form-label required">82. C. Name of the advocate</label>
<input type="text" class="form-control" formControlName="NameOfAdvocate" placeholder="Enter advocate name" required />
</div>





<div *ngIf="show94BAnd94C" class="col-md-6 mb-3">
<label class="form-label required">82. D. Phone Number of the advocate</label>
<input
type="text"
class="form-control"
formControlName="advocateMobNumber"
placeholder="Enter mobile Number"
maxlength="10"
(keypress)="allowOnlyNumbers($event)"
/>
<div *ngIf="firForm.get('advocateMobNumber')?.invalid && (firForm.get('advocateMobNumber')?.touched || firForm.get('advocateMobNumber')?.dirty)" class="text-danger">
<div *ngIf="firForm.get('advocateMobNumber')?.errors?.['required']">Phone number is required.</div>
<div *ngIf="firForm.get('advocateMobNumber')?.errors?.['pattern']">Phone number must contain only numbers.</div>
<div *ngIf="firForm.get('advocateMobNumber')?.errors?.['minlength'] || firForm.get('advocateMobNumber')?.errors?.['maxlength']">Phone number must be exactly 10 digits.</div>
</div>
</div>









                    <!-- Item 77 -->
                    <div *ngIf="firForm.get('CaseHandledBy')?.value === 'Special Public Prosecutor'" class="col-md-6 mb-3">
                        <label class="form-label required">83. Special Public Prosecutor's Name</label>
                        <input type="text" class="form-control" formControlName="publicProsecutor" placeholder="Enter Name" />
                    </div>
                    <!-- Item 78 -->
                    <div *ngIf="firForm.get('CaseHandledBy')?.value === 'Special Public Prosecutor'" class="col-md-6 mb-3">
                        <label class="form-label required">84. Special Public Prosecutor's Phone Number</label>
                        <input type="text" class="form-control" formControlName="prosecutorPhone" placeholder="Enter Phone Number"  (keypress)="allowOnlyNumbers($event)"
                        maxlength="10">
                    </div>
                </div>
            </div>
        </div>







        <!-- Select Hearing Date -->
        <div class="card border-primary mb-4">
            <div class="card-body">
                <h4 class="mb-4">Select Hearing Date</h4>
                <div class="row">
                    <!-- First Hearing Date -->
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">85. First Hearing Date</label>
                        <input type="date" class="form-control" formControlName="firstHearingDate" required />
                    </div>

                    <!-- Has a Judgement been awarded in the case? -->
                    <div class="col-md-6">
                        <label class="form-label required">86. Has a Judgement been awarded in the case?</label>
                        <select formControlName="judgementAwarded" class="form-select" (change)="onJudgementSelectionChange($event)">
                            <option value="" disabled>Select One</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>





            </div>
        </div>








        <!-- ........................................................... -->



        <div *ngIf="firForm.get('judgementAwarded')?.value === 'no'">
          <div class="border border-primary rounded p-3 mb-4">
            <div formArrayName="hearingDetails">
              <div *ngFor="let hearing of hearingDetails.controls; let i = index" [formGroupName]="i" class="row mb-3">
                <!-- Next Hearing Date -->
                <div class="col-md-4 mb-3">
                  <label class="form-label required">87. Next Hearing Date</label>
                  <input
                    type="date"
                    class="form-control"
                    formControlName="nextHearingDate"
                    placeholder="Select Next Hearing Date"
                  />
                </div>

                <!-- Reason for Next Hearing -->
                <div class="col-md-4 mb-3">
                  <label class="form-label required">88. Reason for Next Hearing</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="reasonNextHearing"
                    placeholder="Enter Reason"
                  />
                </div>

                <!-- Buttons for Add and Delete -->
                <div class="col-md-4 d-flex align-items-end">
                  <button type="button" class="btn btn-primary me-2" (click)="addHearingDetail()">
                    <i class="bi bi-plus-circle"></i>
                  </button>

                  <!-- Delete button will not be shown for the first index -->
                  <button *ngIf="i !== 0" type="button" class="btn btn-danger" (click)="removeHearingDetail(i)">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>




            <!-- .......................... -->
            <div class="row align-items-center">
            <div class="col-md-6">
              <label class="form-label required">89. Has a Judgement been awarded in the case?</label>

          </div>
          <div class="col-md-3">
            <select formControlName="judgementAwarded1" class="form-select" (change)="onJudgementSelectionChangehearing($event)">
                <option value="" disabled>Select One</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        </div>
          </div>
        </div>



                <div *ngIf="firForm.get('judgementAwarded')?.value === 'yes' || firForm.get('judgementAwarded1')?.value === 'yes'" formGroupName="judgementDetails">
                  <!-- Nature of Judgement and Upload Judgement Copy Section -->
                  <div class="border border-primary rounded p-3 mb-4">
                    <h5 class="text-primary">Judgement Details</h5>
                    <div class="row align-items-center">
                      <!-- Nature of Judgement -->
                      <div class="col-md-6">
                        <label class="form-label required">87. Nature of Judgement</label>
                        <select
                          class="form-select"
                          formControlName="judgementNature"
                          (change)="onJudgementNatureChange()"
                          required
                        >
                          <!-- <option value="" selected disabled>Select Nature of Judgement</option> -->
                          <option value="Convicted">Accused person(s) has been Convicted</option>
                          <option value="Acquitted">Accused person(s) have been Acquitted</option>
                          <option value="Charge_Abated">Charge Abated</option>
                          <option value="Quashed">Quashed</option>
                        </select>
                      </div>

                        <div *ngIf="firForm.get('judgementDetails.judgementNature')?.value" class="col-md-4 mb-3">
                          <label class="form-label required">87a. Judgement Date</label>
                          <input
                            type="date"
                            class="form-control"
                            formControlName="Judgement_Date"
                            placeholder="Judgement Date"
                          />
                        </div>


                      <div *ngIf="firForm.get('judgementDetails.judgementNature')?.value === 'Convicted'" class="col-md-6">
                        <label class="form-label">Conviction Type</label>
                        <select
                          class="form-select"
                          formControlName="Conviction_Type"
                        >
                          <option value="" selected disabled>Select Conviction Type</option>
                          <option value="Life Sentence">Life Sentence</option>
                          <option value="Below 5 years imprisonment">Below 5 years imprisonment</option>
                          <option value="Others">Others</option>
                          <option value="Below 1 year imprisonment">Below 1 year imprisonment</option>
                          <option value="Above 20 Years imprisonment">Above 20 Years imprisonment</option>
                          <option value="Double Life Sentence">Double Life Sentence</option>
                          <option value="Above 10 Years imprisonment">Above 10 Years imprisonment</option>
                          <option value="Above 5 Years imprisonment">Above 5 Years imprisonment</option>
                        </select>
                      </div>

 
                        <div *ngIf="firForm.get('judgementDetails.judgementNature')?.value" class="col-md-12 mb-3">
                          <label for="judgement_nature_remarks" class="form-label">Remarks</label>
                          <textarea id="judgement_nature_remarks" class="form-control" formControlName="judgement_nature_remarks" rows="4" maxlength="3000" placeholder="Remarks"> </textarea>
                          <small class="form-text text-muted">Maximum of 3000 Characters</small>
                        </div>

                      <!-- Upload Judgement Copy -->
                      <!-- <div class="col-md-6">
                        <label class="form-label">88. Upload Judgement Copy *</label>
                        <input
                          type="file"
                          class="form-control"
                          id="uploadJudgement"
                          (change)="uploadJudgementSelect($event)"
                          formControlName="uploadJudgement"
                          required
                        />
                      </div> -->

                      <div class="col-md-6">
                        <label class="form-label">88. Upload Judgement Copy</label> <span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
                        <input
                          type="file"
                          class="form-control"
                          id="uploadJudgement"
                          (change)="uploadJudgementSelect($event)"
                          *ngIf="!uploadJudgement"
                          required
                        />
                        <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="uploadJudgement">
                          <div class="d-flex justify-content-start align-items-center">
                            {{uploadJudgement}}
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
                            <button class="btn btn-primary btn-sm me-2" (click)="viewuploadJudgement()">View</button>
                            <button class="btn btn-danger btn-sm" (click)="removeuploadJudgement()"><i class="fas fa-times"></i></button>
                          </div>
                        </div>
                      
                        <!-- Image Preview -->
                        <!-- <div *ngIf="uploadJudgementPreview" class="mt-2">
                          <img
                            [src]="uploadJudgementPreview"
                            alt="Judgement Copy Preview"
                            class="img-thumbnail"
                            style="max-width: 150px; max-height: 150px"
                          />
                        </div> -->
                      </div>
                      
                    </div>
                  </div>

                  <!-- Appeal Details Section -->
                  <div class="border border-primary rounded p-3 mb-4" *ngIf="showLegalOpinionObtained || showFiledBy || showDesignatedCourt">
                    <h5 class="text-primary">Appeal Details</h5>
                    <div class="row align-items-center">
                      <!-- Has legal opinion obtained -->
                      <div class="col-md-6" *ngIf="showLegalOpinionObtained">
                        <label class="form-label">97. Has legal opinion obtained?</label>
                        <select
                          class="form-select"
                          formControlName="legalOpinionObtained"
                          (change)="onLegalOpinionChange()"
                        >
                          <option value="" disabled selected>Select Option</option>
                          <option value="yes">Yes</option>
                          <option value="no">No</option>
                        </select>
                      </div>

                      <!-- Is the case fit for appeal -->
                      <div *ngIf="showCaseFitForAppeal" class="col-md-6 mt-3">
                        <label class="form-label">98. Is the case fit for appeal?</label>
                        <select class="form-select" formControlName="caseFitForAppeal">
                          <option value="" disabled selected>Select Option</option>
                          <option value="yes">Yes</option>
                          <option value="no">No</option>
                        </select>
                      </div>

                      <!-- Has the government approved for appeal -->
                      <div *ngIf="showCaseFitForAppeal" class="col-md-6 mt-3">
                        <label class="form-label">99. Has the government approved for appeal?</label>
                        <select class="form-select" formControlName="governmentApprovalForAppeal">
                          <option value="" disabled selected>Select Option</option>
                          <option value="yes">Yes</option>
                          <option value="no">No</option>
                        </select>
                      </div>

                      <!-- Who has filed the appeal -->
                      <div class="col-md-6 mt-3" *ngIf="showFiledBy">
                        <label class="form-label required">100. Who has filed the appeal?</label>
                        <select class="form-select" formControlName="filedBy">
                          <option value="" disabled selected>Select Option</option>
                          <option value="victim">Victim</option>
                          <option value="government">Government</option>
                          <option value="No appeal yet">No appeal yet</option>
                        </select>
                      </div>

                      <!-- Name of the Designated/ Special court -->
                      <div class="col-md-6 mt-3" *ngIf="showDesignatedCourt">
                        <label class="form-label">101. Name of the Designated/ Special court</label>
                        <select
                        class="form-select"
                        formControlName="designatedCourt"
                        (change)="onDesignatedCourtChange($event)"
                      >
                          <option value="" disabled selected>Select Option</option>
                          <option value="highCourt">High Court</option>
                          <option value="supremeCourt">Supreme Court</option>
                        </select>
                      </div>




                    </div>
                  </div>
                </div>


                <div *ngIf="showDuplicateSection">
                  <div class="card border-primary">
                    <div class="card-body">
                        <h4 class="mb-4">Case Trial and Court Details</h4>
                        <div class="row">
                            <!-- Item 74 -->
                            <!-- <div class="col-md-6 mb-3">
                                <label class="form-label">1. Name of the Designated / Special court *</label>
                                <input type="text" class="form-control" formControlName="Court_one" placeholder="Enter Name" required />
                            </div> -->


                            <div class="col-md-6 mb-3" *ngIf="selectedCourtType==='highCourt'">
                              <label class="form-label required">1. District in which court is present</label>
                              <select class="form-select" formControlName="courtDistrict_one" required>
                                <option value="" disabled selected>Select District</option>
                                <option value="Chennai">Chennai</option>
                                <option value="Madurai">Madurai</option>
                                <!-- <option *ngFor="let district of courtDistricts" [value]="district">{{ district }}</option> -->
                              </select>
                            </div>
                            <!-- Item 76 -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">2. CNR Numbers</label>
                                <input type="text" class="form-control" formControlName="caseNumber_one" placeholder="Enter CNR Number" required />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">2a. CRL. A Number</label>
                                <input type="text" class="form-control" formControlName="CRL_number_one" placeholder="Enter CRL Number" required />
                            </div>
                            <!-- Item 77 -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">3. Special Public Prosecutor's Name</label>
                                <input type="text" class="form-control" formControlName="publicProsecutor_one" placeholder="Enter Name" required >
                            </div>
                            <!-- Item 78 -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">4. Special Public Prosecutor's Phone Number</label>
                                <input type="text" class="form-control" formControlName="prosecutorPhone_one" placeholder="Enter Phone Number" required  (keypress)="allowOnlyNumbers($event)"
                                maxlength="10">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Select Hearing Date -->
                <div class="card border-primary mb-4 mt-3">
                    <div class="card-body">
                        <h4 class="mb-4">Select Hearing Date</h4>
                        <div class="row">
                            <!-- First Hearing Date -->
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">5. First Hearing Date</label>
                                <input type="date" class="form-control" formControlName="firstHearingDate_one" required />
                            </div>

                            <!-- Has a Judgement been awarded in the case? -->
                            <div class="col-md-4">
                              <label class="form-label required">6. Has a Judgement been awarded in the case?</label>
                              <select
                                formControlName="judgementAwarded_one"
                                class="form-select"
                                (change)="onJudgementSelectionChange_one($event)"
                              >
                                <option value="" disabled>Select One</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                              </select>
                            </div>

                        </div>





                    </div>
                </div>



                <div >
                  <div *ngIf="this.firForm.get('judgementDetails.judgementAwarded_one')?.value == 'no'" class="border border-primary rounded p-3 mb-4">
                    <!-- Wrap the entire section with formArrayName -->
                    <div formArrayName="hearingDetails_one">
                      <div
                        class="row mb-3"
                        *ngFor="let hearing of hearingDetails_one.controls; let i = index"
                        [formGroupName]="i"
                      >
                        <!-- Next Hearing Date -->
                        <div class="col-md-4 mb-3">
                          <label class="form-label required">9. Next Hearing Date</label>
                          <input
                            type="date"
                            class="form-control"
                            formControlName="nextHearingDate_one"
                            placeholder="Select Next Hearing Date"
                          />
                        </div>

                        <!-- Reason for Next Hearing -->
                        <div class="col-md-4 mb-3">
                          <label class="form-label required">10. Reason for Next Hearing</label>
                          <input
                            type="text"
                            class="form-control"
                            formControlName="reasonNextHearing_one"
                            placeholder="Enter Reason"
                          />
                        </div>

                        <!-- Add/Remove Buttons -->
                        <div class="col-md-4 d-flex align-items-end">
                          <button
                            type="button"
                            class="btn btn-primary me-2"
                            (click)="addHearingDetail_one()"
                          >
                            <i class="bi bi-plus-circle"></i>
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger"
                            (click)="removeHearingDetail_one(i)"
                             *ngIf="i !== 0"
                          >
                            <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="row align-items-center">
                      <div class="col-md-6">
                        <label class="form-label required">11. Has a Judgement been awarded in the case?</label>

                    </div>
                    <div class="col-md-3">
                      <select formControlName="judgementAwarded2" class="form-select" (change)="onJudgementSelectionChangehearing1($event)">
                          <option value="" disabled>Select One</option>
                          <option value="yes">Yes</option>
                          <option value="no">No</option>
                      </select>
                  </div>
                  </div>
                  </div>
                </div>



      <div *ngIf="firForm.get('judgementAwarded_one')?.value === 'yes' || firForm.get('judgementAwarded2')?.value === 'yes'" formGroupName="judgementDetails_one">
                          <!-- Nature of Judgement and Upload Judgement Copy Section -->
                          <div class="border border-primary rounded p-3 mb-4">
                            <h5 class="text-primary">Judgement Details</h5>
                            <div class="row align-items-center">
                              <!-- Nature of Judgement -->
                              <div class="col-md-6">
                                <label class="form-label required">12. Nature of Judgement</label>
                                <select
                                  class="form-select"
                                  formControlName="judgementNature_one"
                                  (change)="onJudgementNatureChange_one()"
                                  required
                                >
                                  <option value="" disabled>Select Nature of Judgement</option>
                                  <option value="Convicted_one">Accused person(s) has been Convicted</option>
                                  <option value="Acquitted_one">Accused person(s) have been Acquitted</option>
                                  <option value="Charge_Abated_one">Charge Abated</option>
                                  <option value="Quashed_one">Quashed</option>
                                </select>
                              </div>

                              <div *ngIf="firForm.get('judgementDetails_one.judgementNature_one')?.value" class="col-md-4 mb-3">
                                <label class="form-label required">12a. Judgement Date</label>
                                <input
                                  type="date"
                                  class="form-control"
                                  formControlName="Judgement_Date_one"
                                  placeholder="Judgement Date"
                                />
                              </div>

                              <div *ngIf="firForm.get('judgementDetails_one.judgementNature_one')?.value === 'Convicted_one'" class="col-md-6">
                                <label class="form-label">Conviction Type</label>
                                <select
                                  class="form-select"
                                  formControlName="Conviction_Type_one"
                                >
                                  <option value="" selected disabled>Select Conviction Type</option>
                                  <option value="Life Sentence">Life Sentence</option>
                                  <option value="Below 5 years imprisonment">Below 5 years imprisonment</option>
                                  <option value="Others">Others</option>
                                  <option value="Below 1 year imprisonment">Below 1 year imprisonment</option>
                                  <option value="Above 20 Years imprisonment">Above 20 Years imprisonment</option>
                                  <option value="Double Life Sentence">Double Life Sentence</option>
                                  <option value="Above 10 Years imprisonment">Above 10 Years imprisonment</option>
                                  <option value="Above 5 Years imprisonment">Above 5 Years imprisonment</option>
                                </select>
                              </div>

                        <div *ngIf="firForm.get('judgementDetails_one.judgementNature_one')?.value" class="col-md-12 mb-3">
                          <label for="judgement_nature_remarks_one" class="form-label">Remarks</label>
                          <textarea id="judgement_nature_remarks_one" class="form-control" formControlName="judgement_nature_remarks_one" rows="4" maxlength="3000" placeholder="Remarks"> </textarea>
                          <small class="form-text text-muted">Maximum of 3000 Characters</small>
                        </div>

                              <!-- Upload Judgement Copy -->
                        


                              <div class="col-md-6">
                                <label class="form-label required">13. Upload Judgement Copy</label>
                                <input
                                  type="file"
                                  class="form-control"
                                  id="uploadJudgement_one"
                                  (change)="uploadJudgementSelect_one($event)"
                                  *ngIf="!uploadJudgement_one"
                                  required
                                />
                                <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="uploadJudgement_one">
                                  <div class="d-flex justify-content-start align-items-center">
                                    {{uploadJudgement_one}}
                                  </div>
                                  <div class="d-flex justify-content-between align-items-center">
                                    <button class="btn btn-primary btn-sm me-2" (click)="viewuploadJudgementone()">View</button>
                                    <button class="btn btn-danger btn-sm" (click)="removeuploadJudgementone()"><i class="fas fa-times"></i></button>
                                  </div>
                                </div>
                              
                                <!-- Image Preview -->
                                <!-- <div *ngIf="uploadJudgementPreview_one" class="mt-2">
                                  <img
                                    [src]="uploadJudgementPreview_one"
                                    alt="Judgement Copy Preview"
                                    class="img-thumbnail"
                                    style="max-width: 150px; max-height: 150px"
                                  />
                                </div> -->
                              </div>
                              
                            </div>
                          </div>

                          <!-- Appeal Details Section -->
                          <div
                            class="border border-primary rounded p-3 mb-4"
                            *ngIf="showLegalOpinionObtained_one || showFiledBy_one || showDesignatedCourt_one"
                          >
                            <h5 class="text-primary">Appeal Details</h5>
                            <div class="row align-items-center">
                              <!-- Has legal opinion obtained -->
                              <div class="col-md-6" *ngIf="showLegalOpinionObtained_one">
                                <label class="form-label">13. Has legal opinion obtained?</label>
                                <select
                                  class="form-select"
                                  formControlName="legalOpinionObtained_one"
                                  (change)="onLegalOpinionChange_one()"
                                >
                                  <option value="" disabled>Select Option</option>
                                  <option value="yes">Yes</option>
                                  <option value="no">No</option>
                                </select>
                              </div>

                              <!-- Is the case fit for appeal -->
                              <div class="col-md-6" *ngIf="showCaseFitForAppeal_one">
                                <label class="form-label">15. Is the case fit for appeal?</label>
                                <select class="form-select" formControlName="caseFitForAppeal_one">
                                  <option value="" disabled>Select Option</option>
                                  <option value="yes">Yes</option>
                                  <option value="no">No</option>
                                </select>
                              </div>


                              <div *ngIf="showCaseFitForAppeal_one" class="col-md-6 mt-3">
                                <label class="form-label">16. Has the government approved for appeal?</label>
                                <select class="form-select" formControlName="governmentApprovalForAppeal_one">
                                  <option value="" disabled selected>Select Option</option>
                                  <option value="yes">Yes</option>
                                  <option value="no">No</option>
                                </select>
                              </div>

                              <!-- Who has filed the appeal -->
                              <div class="col-md-6" *ngIf="showFiledBy_one">
                                <label class="form-label">17. Who has filed the appeal?</label>
                                <select class="form-select" formControlName="filedBy_one">
                                  <option value="" disabled>Select Option</option>
                                  <option value="victim">Victim</option>
                                  <option value="government">Government</option>
                                </select>
                              </div>

                              <!-- Name of the Designated/Special Court -->
                              <div class="col-md-6" *ngIf="showDesignatedCourt_one">
                                <label class="form-label">18. Name of the Designated/Special Court</label>
                                <select class="form-select" formControlName="designatedCourt_one" (change)="onDesignatedCourtChange_one($event)">
                                  <option value="" disabled>Select Option</option>
                                  <!-- <option value="highCourt_one">High Court</option> -->
                                  <option value="supremeCourt_one">Supreme Court</option>
                                </select>
                              </div>
                            </div>
                          </div>
      </div>



                </div>


                <div *ngIf="showDuplicateSection_1">
                  <div class="card border-primary">
                    <div class="card-body">
                        <h4 class="mb-4">Case Trial and Court Details</h4>
                        <div class="row">


                          <div class="col-md-6 mb-3">
                            <label class="form-label required">2. District in which court is present</label>
                            <select class="form-select" formControlName="courtDistrict_two" required>
                              <option value="" disabled selected>Select District</option>
                              <option *ngFor="let district of courtDistricts" [value]="district">{{ district }}</option>
                            </select>
                          </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label required">3. CNR Number</label>
                                <input type="text" class="form-control" formControlName="caseNumber_two" placeholder="Enter CRM Number" required />
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label required">3a. CRL. A Number</label>
                                <input type="text" class="form-control" formControlName="CRL_number_two" placeholder="Enter CLR Number" required />
                            </div>

                            <!-- Item 77 -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">4. Special Public Prosecutor's Name</label>
                                <input type="text" class="form-control" formControlName="publicProsecutor_two" placeholder="Enter Name" required />
                            </div>
                            <!-- Item 78 -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">5. Special Public Prosecutor's Phone Number</label>
                                <input type="text" class="form-control" formControlName="prosecutorPhone_two" placeholder="Enter Phone Number" required  (keypress)="allowOnlyNumbers($event)"
                                maxlength="10">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Select Hearing Date -->
                <div class="card border-primary mb-4 mt-3">
                    <div class="card-body">
                        <h4 class="mb-4">Select Hearing Date</h4>
                        <div class="row">
                            <!-- First Hearing Date -->
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">6. First Hearing Date</label>
                                <input type="date" class="form-control" formControlName="firstHearingDate_two" required />
                            </div>

                            <!-- Has a Judgement been awarded in the case? -->
                            <div class="col-md-6">
                              <label class="form-label required">7. Has a Judgement been awarded in the case?</label>
                              <select
                                formControlName="judgementAwarded_two"
                                class="form-select"
                                (change)="onJudgementSelectionChange_two($event)"
                              >
                                <option value="" disabled>Select One</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                              </select>
                            </div>

                        </div>





                    </div>
                </div>



                <div *ngIf="firForm.get('judgementAwarded_two')?.value === 'no'">
                  <div class="border border-primary rounded p-3 mb-4">
                    <!-- Wrap the entire section with formArrayName -->
                    <div formArrayName="hearingDetails_two">
                      <div
                        class="row mb-3"
                        *ngFor="let hearing of hearingDetails_two.controls; let i = index"
                        [formGroupName]="i"
                      >
                        <!-- Next Hearing Date -->
                        <div class="col-md-4 mb-3">
                          <label class="form-label required">9. Next Hearing Date</label>
                          <input
                            type="date"
                            class="form-control"
                            formControlName="nextHearingDate_two"
                            placeholder="Select Next Hearing Date"
                          />
                        </div>

                        <!-- Reason for Next Hearing -->
                        <div class="col-md-4 mb-3">
                          <label class="form-label required">10. Reason for Next Hearing</label>
                          <input
                            type="text"
                            class="form-control"
                            formControlName="reasonNextHearing_two"
                            placeholder="Enter Reason"
                          />
                        </div>

                        <!-- Add/Remove Buttons -->
                        <div class="col-md-4 d-flex align-items-end">
                          <button
                            type="button"
                            class="btn btn-primary me-2"
                            (click)="addHearingDetail_two()"
                          >
                            <i class="bi bi-plus-circle"></i>
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger"
                            (click)="removeHearingDetail_two(i)"
                            *ngIf="i !== 0"
                          >
                            <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="row align-items-center">
                      <div class="col-lg-6">
                        <label class="form-label required">11. Has a Judgement been awarded in the case?</label>

                    </div>
                    <div class="col-md-3">
                      <select formControlName="judgementAwarded3" class="form-select" (change)="onJudgementSelectionChangehearing2($event)">
                          <option value="" disabled>Select One</option>
                          <option value="yes">Yes</option>
                          <option value="no">No</option>
                      </select>
                  </div>
                  </div>
                  </div>
                </div>



                <div *ngIf="firForm.get('judgementAwarded_two')?.value === 'yes' || firForm.get('judgementAwarded3')?.value === 'yes'" formGroupName="judgementDetails_two">
                          <!-- Nature of Judgement and Upload Judgement Copy Section -->
                          <div class="border border-primary rounded p-3 mb-4">
                            <h5 class="text-primary">Judgement Details</h5>
                            <div class="row align-items-center">
                              <!-- Nature of Judgement -->
                              <div class="col-md-6">
                                <label class="form-label required">12. Nature of Judgement</label>
                                <select
                                  class="form-select"
                                  formControlName="judgementNature_two"
                                  (change)="onJudgementNatureChange_two()"
                                  required
                                >
                                  <option value="" disabled>Select Nature of Judgement</option>
                                  <option value="Convicted_two">Accused person(s) has been Convicted</option>
                                  <option value="Acquitted_two">Accused person(s) have been Acquitted</option>
                                  <option value="Charge_Abated_two">Charge Abated</option>
                                  <option value="Quashed_two">Quashed</option>
                                </select>
                              </div>

                              <div *ngIf="firForm.get('judgementDetails_two.judgementNature_two')?.value" class="col-md-4 mb-3">
                                <label class="form-label required">12a. Judgement Date</label>
                                <input
                                  type="date"
                                  class="form-control"
                                  formControlName="Judgement_Date_two"
                                  placeholder="Judgement Date"
                                />
                              </div>

                              <div *ngIf="firForm.get('judgementDetails_two.judgementNature_two')?.value === 'Convicted_two'" class="col-md-6">
                                <label class="form-label">Conviction Type</label>
                                <select
                                  class="form-select"
                                  formControlName="Conviction_Type_two"
                                >
                                  <option value="" selected disabled>Select Conviction Type</option>
                                  <option value="Life Sentence">Life Sentence</option>
                                  <option value="Below 5 years imprisonment">Below 5 years imprisonment</option>
                                  <option value="Others">Others</option>
                                  <option value="Below 1 year imprisonment">Below 1 year imprisonment</option>
                                  <option value="Above 20 Years imprisonment">Above 20 Years imprisonment</option>
                                  <option value="Double Life Sentence">Double Life Sentence</option>
                                  <option value="Above 10 Years imprisonment">Above 10 Years imprisonment</option>
                                  <option value="Above 5 Years imprisonment">Above 5 Years imprisonment</option>
                                </select>
                              </div>

                        <div *ngIf="firForm.get('judgementDetails_two.judgementNature_two')?.value" class="col-md-12 mb-3">
                          <label for="judgement_nature_remarks_two" class="form-label">Remarks</label>
                          <textarea id="judgement_nature_remarks_two" class="form-control" formControlName="judgement_nature_remarks_two" rows="4" maxlength="3000" placeholder="Remarks"> </textarea>
                          <small class="form-text text-muted">Maximum of 3000 Characters</small>
                        </div>

                              <!-- Upload Judgement Copy -->
                              <!-- <div class="col-md-6">
                                <label class="form-label">13. Upload Judgement Copy *</label>
                                <input type="file" class="form-control" id="uploadJudgement_two" formControlName="uploadJudgement_two" />
                              </div> -->

                              <div class="col-md-6">
                                <label class="form-label required">13. Upload Judgement Copy</label>
                                <input
                                  type="file"
                                  class="form-control"
                                  id="uploadJudgement_two"
                                  (change)="uploadJudgementSelect_two($event)"
                                  *ngIf="!uploadJudgement_two"
                                  required
                                />
                                <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="uploadJudgement_two">
                                  <div class="d-flex justify-content-start align-items-center">
                                    {{uploadJudgement_two}}
                                  </div>
                                  <div class="d-flex justify-content-between align-items-center">
                                    <button class="btn btn-primary btn-sm me-2" (click)="viewuploadJudgementtwo()">View</button>
                                    <button class="btn btn-danger btn-sm" (click)="removeuploadJudgementtwo()"><i class="fas fa-times"></i></button>
                                  </div>
                                </div>
                              
                                <!-- Image Preview -->
                                <!-- <div *ngIf="uploadJudgementPreview_two" class="mt-2">
                                  <img
                                    [src]="uploadJudgementPreview_two"
                                    alt="Judgement Copy Preview"
                                    class="img-thumbnail"
                                    style="max-width: 150px; max-height: 150px"
                                  />
                                </div> -->
                              </div>
                            </div>
                          </div>

                          <!-- Appeal Details Section -->
                          <div
                            class="border border-primary rounded p-3 mb-4"
                            *ngIf="showLegalOpinionObtained_two || showFiledBy_two || showDesignatedCourt_two"
                          >
                            <h5 class="text-primary">Appeal Details</h5>
                            <div class="row align-items-center">
                              <!-- Has legal opinion obtained -->
                              <div class="col-md-6" *ngIf="showLegalOpinionObtained_two">
                                <label class="form-label">1. Has legal opinion obtained?</label>
                                <select
                                  class="form-select"
                                  formControlName="legalOpinionObtained_two"
                                  (change)="onLegalOpinionChange_two()"
                                >
                                  <option value="" disabled>Select Option</option>
                                  <option value="yes">Yes</option>
                                  <option value="no">No</option>
                                </select>
                              </div>

                              <!-- Is the case fit for appeal -->
                              <div class="col-md-6" *ngIf="showCaseFitForAppeal_two">
                                <label class="form-label">2. Is the case fit for appeal?</label>
                                <select class="form-select" formControlName="caseFitForAppeal_two">
                                  <option value="" disabled>Select Option</option>
                                  <option value="yes">Yes</option>
                                  <option value="no">No</option>
                                </select>
                              </div>


                              <div *ngIf="showCaseFitForAppeal_two" class="col-md-6 mt-3">
                                <label class="form-label">3. Has the government approved for appeal?</label>
                                <select class="form-select" formControlName="governmentApprovalForAppeal_two">
                                  <option value="" disabled selected>Select Option</option>
                                  <option value="yes">Yes</option>
                                  <option value="no">No</option>
                                </select>
                              </div>

                              <!-- Who has filed the appeal -->
                              <div class="col-md-6" *ngIf="showFiledBy_two">
                                <label class="form-label">4. Who has filed the appeal?</label>
                                <select class="form-select" formControlName="filedBy_two">
                                  <option value="" disabled>Select Option</option>
                                  <option value="victim_two">Victim</option>
                                  <option value="government_two">Government</option>
                                </select>
                              </div>

                              <!-- Name of the Designated/Special Court -->
                              <!-- <div class="col-md-6" *ngIf="showDesignatedCourt_three">
                                <label class="form-label">18. Name of the Designated/Special Court</label>
                                <select class="form-select" formControlName="designatedCourt_two">
                                  <option value="" disabled>Select Option</option>
                                  <option value="highCourt_two">High Court</option>
                                  <option value="supremeCourt_two">Supreme Court</option>
                                </select>
                              </div> -->
                            </div>
                          </div>
                        </div>



                </div>



              <ng-container *ngIf="firForm.get('judgementAwarded1')?.value === 'yes' || firForm.get('judgementAwarded')?.value === 'yes'">
                <div  *ngIf="!hideCompensationSection && (firForm.get('judgementDetails.judgementNature')?.value == 'Convicted' || firForm.get('judgementDetails.filedBy')?.value != 'No appeal yet')">
                    <div formArrayName="victimsRelief">
                      <div *ngFor="let victimRelief of victimsRelief.controls; let i = index" [formGroupName]="i"  class="card border-primary mb-4">
                         <div class="card-body">
                  <h5 class="text-primary">Victim #{{ i + 1 }} Relief Details</h5>

                 
                  <div class="mb-4 col-lg-4">
                      <label class="form-label required">89. Name of the Victim</label>
                      <input type="text" class="form-control mb-3" [value]="victimNames?.[i] || ''" placeholder="Name of the Victim" disabled />
                  </div>

                  <div class="row mb-3">
                      <div class="col-8">
                          <label class="form-label required">86. Eligible third stage relief amount for the victim as per the SC and ST Prevention of Atrocities Act</label>
                      </div>
                      <div class="col-4 text-end">
                          <input type="text" class="form-control text-end" formControlName="reliefAmountScst_2"  (keypress)="allowOnlyNumbers($event)"/>
                      </div>
                  </div>

                  <div class="row mb-3">
                      <div class="col-8">
                          <label class="form-label required">90. Eligible third stage relief amount for the victim (ex-gratia) by the Govt. of Tamil Nadu</label>
                      </div>
                      <div class="col-4 text-end">
                          <input type="text" class="form-control text-end" formControlName="reliefAmountExGratia_2"  (keypress)="allowOnlyNumbers($event)"/>
                      </div>
                  </div>

                  <div class="row mb-3">
                      <div class="col-8">
                          <label class="form-label required">91. Total Eligible amount for the victim for the Third stage of relief</label>
                      </div>
                      <div class="col-4 text-end">
                          <input type="text" class="form-control text-end" formControlName="reliefAmountThirdStage" (keypress)="allowOnlyNumbers($event)"/>
                      </div>
                  </div>
              </div>
          </div>

          </div>

          <div class="card border-primary mb-4">
              <div class="card-body">
              
                  <div class="row mb-4">
                      <div class="col-8">
                          <label class="form-label required">92. Total amount for third stage of compensation (total of relief across all victims)</label>
                      </div>
                      <div class="col-4">
                          <input type="text" class="form-control text-end" formControlName="totalCompensation_2"/>
                      </div>
                  </div>

                
                  <div class="row mb-4">
                      <div class="col-md-6 mb-3">
                          <label class="form-label required">93. Proceedings File No.</label>
                          <input type="text" class="form-control" formControlName="proceedingsFileNo_2" placeholder="Enter File No." />
                      </div>
                      <div class="col-md-6 mb-3">
                          <label class="form-label required">94. Proceedings Date</label>
                          <input type="date" class="form-control" formControlName="proceedingsDate_2" [max]="today" />
                      </div>
               
                      <div class="col-md-12 mb-3">
                        <label class="form-label required">95. Upload Commissionerate / S.P. Office Proceedings</label> <span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>
                        <input
                          type="file"
                          (change)="uploadProceedings_2New($event)"
                          class="form-control"
                          *ngIf="!file95"
                        />
                        <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="file95">
                          <div class="d-flex justify-content-start align-items-center">
                            {{file95}}
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
                            <button class="btn btn-primary btn-sm me-2" (click)="view95()">View</button>
                            <button class="btn btn-danger btn-sm" (click)="remove95()"><i class="fas fa-times"></i></button>
                          </div>
                        </div>
                      
                        <!-- <div *ngIf="uploadProceedings_2_preview" class="mt-3">
                          <img 
                            [src]="uploadProceedings_2_preview" 
                            alt="Uploaded Image" 
                            class="img-thumbnail" 
                            style="max-width: 200px; max-height: 200px;" 
                          />
                        </div> -->
                      </div>
                      

                  </div>

         
                  <!-- <div class="mb-4" formArrayName="attachments_2">
                    <label class="form-label">96. Upload Other Attachments (If any)</label>
                  
                    <div
                      class="mb-3"
                      *ngFor="let attachment of attachments_2.controls; let j = index"
                      [formGroupName]="j"
                    >
                      <div class="input-group">
                        <input
                          type="file"
                          class="form-control"
                          (change)="onFileSelect_2($event, j)"
                          formControlName="file_2"
                          accept="image/*"
                        />
                  
                        <button
                          type="button"
                          class="btn btn-danger btn-sm ms-2"
                          (click)="removeAttachment_2(j)"
                          *ngIf="attachments_2.length > 1"
                          title="Remove Attachment"
                        >
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                      <div *ngIf="filePreviews[j]" class="mt-2">
                        <img
                          [src]="filePreviews[j]"
                          alt="Preview"
                          class="img-thumbnail"
                          style="max-width: 150px; max-height: 150px"
                        />
                      </div>
                    </div>
                  
                    <button type="button" class="btn btn-primary btn-sm" (click)="addAttachment_2()">
                      Add Attachment
                    </button>
                  </div> -->
                  <div class="mb-4" formArrayName="attachments_2">
  <label class="form-label">96. Upload Other Attachments (If any)</label> <span style="color: red;font-size: 9px;margin-left: 10px;" >(The maximum file size allowed is 2 MB)</span>

  <div
    class="mb-3"
    *ngFor="let attachment of attachments_2.controls; let j = index"
    [formGroupName]="j"
  >
    <!-- Before Upload -->
    <div *ngIf="!attachment.get('file_2')?.value" class="input-group">
      <input
        type="file"
        class="form-control"
        (change)="onFileSelect_2($event, j)"
      />
      <button
        type="button"
        class="btn btn-danger btn-sm ms-2"
        (click)="removeAttachment_2(j)"
        *ngIf="attachments_2.length > 1"
        title="Remove Attachment"
      >
        <i class="bi bi-trash"></i>
      </button>
    </div>

    <!-- After Upload -->
    <div class="d-flex justify-content-between align-items-center uploaded" *ngIf="attachment.get('file_2')?.value">
      <div class="d-flex justify-content-start align-items-center">
        {{ attachment.get('fileName_2')?.value }}
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <button
          class="btn btn-primary btn-sm me-2"
          (click)="viewAttachment_2(attachment.get('file_2')?.value)"
        >
          View
        </button>
        <button
          class="btn btn-danger btn-sm"
          (click)="removeAttachment_2(j)"
          title="Remove Attachment"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <button type="button" class="btn btn-primary btn-sm" (click)="addAttachment_2()">
    Add Attachment
  </button>
</div>

              </div>
          </div>
</div>
              </ng-container>
              
        <!-- Navigation Buttons -->
        <div class="mt-4">
            <button type="button" class="btn btn-warning me-2"  [disabled]="!SubmitButton" (click)="saveAsDraft_7()">
                Save as Draft
            </button>
            <button type="button" class="btn btn-secondary me-2" (click)="previousStep()">
                Previous
            </button>
            <!-- (click)="submitStepSeven()" -->
            <button type="submit" class="btn btn-primary"  [disabled]="!isStep7Valid() || !SubmitButton" (click)="saveAsDraft_7();submitStep7()">Submit</button>
        </div>
</div>
    </form>
  </div>
</div>